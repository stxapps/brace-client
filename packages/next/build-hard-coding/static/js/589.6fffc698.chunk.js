"use strict";(self.webpackChunkbrace_client_web=self.webpackChunkbrace_client_web||[]).push([[589],{6589:(e,a,t)=>{t.r(a),t.d(a,{chooseAccount:()=>b,createAccount:()=>g,restoreAccount:()=>K});var r=t(4940),n=t(2820),s=t(9779),o=t(7918),c=t(7917),i=t(4830),l=t(7228),u=t(541),p=t(1885),y=t(7138),d=t(6177),w=t(8159),f=t(8526);const h=(0,d.Hq)(),m="password",g=async e=>{const a=(0,o.Bq)(256);return{appData:e,secretKey:a,wallet:await(0,o.NN)({secretKey:a,password:m}),fromCreateAccount:!0}},K=async(e,a)=>{if(!(0,f.Kg)(a))return{errMsg:"Please fill in your Secret Key."};let t;try{t=await(0,o.NN)({secretKey:a,password:m})}catch(r){return console.log("Error when restore account: ",r),{errMsg:"Your Secret Key is invaid. Please check and try again."}}return{appData:e,wallet:t}},k=async(e,a)=>{const{wallet:t}=e,r=t.accounts[a];let s;if("username"in r||(r.username=await(async e=>{const a=`https://api.hiro.so/v1/addresses/stacks/${(0,c.UR)({account:e,transactionVersion:p.J_.Mainnet})}`;try{let e=await h(a);if(e.ok||(await(0,f.yy)(4e3),e=await h(a)),e.ok){const a=await e.json();if(Array.isArray(a.names)&&a.names.length>0)return a.names[0]}}catch(t){console.log("getUsername error:",t)}return null})(r)),(0,f.Kg)(r.username)&&r.username.length>0&&(s=await(async e=>{const a=`https://api.hiro.so/v1/names/${e}`;try{const e=await h(a);if(e.ok){const a=await e.json(),t=(0,n.parseZoneFile)(a.zonefile),r=(0,u.BL)(t);if((0,f.Kg)(r)&&r.length>0)return r}}catch(t){console.log("getProfileUrlFromZoneFile error:",t)}return null})(r.username),(0,f.Kg)(s)))try{const e=await h(s);if(e.ok){const a=await e.json(),{decodedToken:t}=a[0];return void(r.profile=t.payload.claim)}}catch(o){}},b=async(e,a)=>{const{appData:t,wallet:n,fromCreateAccount:o}=e;o||await k(e,a);const u=n.accounts[a],p=r.SECP256K1Client.derivePublicKey(u.dataPrivateKey),d=(0,y.Fp)(p),h=(0,s._y)(d),m=(0,c.sz)({account:u,appDomain:t.domainName}),g=(0,y.sP)(m.slice(0,64)),K=(0,i.pc)({privateKey:u.dataPrivateKey,childPublicKeyHex:g});let b=w.THB;(0,f.Gv)(u.profile)&&(0,f.Gv)(u.profile.api)&&(0,f.Kg)(u.profile.api.gaiaHubUrl)&&(b=u.profile.api.gaiaHubUrl),b===w.THB&&(b=w.MbX);return{username:u.username||"",email:null,profile:{...u.profile||l.KG,stxAddress:{}},decentralizedID:h,identityAddress:d,appPrivateKey:m,coreSessionToken:null,authResponseToken:null,hubUrl:b,coreNode:null,gaiaAssociationToken:K}}}}]);