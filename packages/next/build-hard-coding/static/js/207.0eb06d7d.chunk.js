"use strict";(self.webpackChunkbrace_client_web=self.webpackChunkbrace_client_web||[]).push([[207],{3207:(s,t,e)=>{e.r(t),e.d(t,{effect:()=>d});var n=e(2517),r=e(3704),o=e(2443),i=e(8583),a=e(1769),c=e(8103),l=e(8159),h=e(8526),u=e(8678);const d=async(s,t)=>{const{method:e,params:n}=s;if(e===c.tH)return g(n);if(e===c.Dx)return y(n);if(e===c.qP||e===c._J)return w(n);if(e===c.lw)return F(n);if(e===c.U7)return m(n);if(e===c.ds)return k(n);if(e===c.Eq)return v(n);if(e===c.E5)return P(n);if(e===c.DI)return D(n);if(e===c.zd)return N(n);if(e===c.pq)return A(n);if(e===c.m3)return S(n);if(e===c.jk)return I(n);if(e===c.Bk)return L(n);if(e===c.uj)return $(n);throw new Error(`${e} is invalid for blockstack effect.`)},f=async s=>{const t=[];for(const o of s)t.push(...o.fpaths);const{responses:e}=await o.A.getFiles(t,!0),n={};for(const{success:o,fpath:i,content:a}of e){const s=o?a:(0,h.mF)(i);n[i]=s}await p(Object.values(n));const r={};for(const o of s){const{id:s,fpaths:t,listName:e}=o;let i;for(const r of t)i=n[r];(0,h.Gv)(i)?((0,h.Gv)(r[e])||(r[e]={}),r[e][s]=i):console.log("In fetchLinks, invalid content",t,n)}return{links:r}},p=async s=>{const t=[];for(const o of s)if((0,h.Gv)(o.custom)){const{image:s}=o.custom;(0,h.Kg)(s)&&s.startsWith(l.d91+"/")&&t.push(s)}const e=[];for(const o of t){const{contentUrl:s}=await i.A.getFile(o);(0,h.Kg)(s)||e.push(o)}const n={},r=[];for(const o of e){let s=(0,h._$)(o);u.Ay.platform.isReactNative&&(s="file://"+s),n[s]=o,r.push(s)}const a=await o.A.getFiles(r,!0);for(let o=0;o<a.fpaths.length;o++)null!==a.contents[o]&&await i.A.putFile(n[a.fpaths[o]],a.contents[o])},g=async s=>{const{getState:t,listName:e,queryString:n,lnOrQt:r,fthId:i}=s,a=t().links,c=t().display.didFetch,l=t().display.didFetchSettings,d=t().display.doForceLock,p=t().pendingSslts,g=t().pendingPins,y=t().pendingTags,w=t().lockSettings.lockedLists;let F=t().settings.doDescendingOrder;const m={fetchedLinkMetas:[],unfetchedLinkMetas:[],hasMore:!1};if(c&&l){const s=(0,h.Xp)(t()),r=(0,h.ln)(t()),o=(0,h.w5)(t()),i=(0,h.x$)(t());let c;if(n){const t=(0,h.pZ)({linkFPaths:s,ssltFPaths:r,pendingSslts:p,links:a,doDescendingOrder:F,pinFPaths:o,pendingPins:g,tagFPaths:i,pendingTags:y,doForceLock:d,lockedLists:w,queryString:n});[c,m.hasMore]=[t.metas,t.hasMore]}else{const t=(0,h.FN)({linkFPaths:s,ssltFPaths:r,pendingSslts:p,links:a,listName:e,doDescendingOrder:F,pinFPaths:o,pendingPins:g});[c,m.hasMore]=[t.metas,t.hasMore]}for(const t of c)(0,h.xn)(u.Ay.fetch.fetchedLinkIds,a,t.listName,t.id)?m.fetchedLinkMetas.push(t):m.unfetchedLinkMetas.push(t)}const k={lnOrQt:r,fthId:i};if(!c||!l){const{linkFPaths:s,ssltFPaths:t,settingsFPaths:r,infoFPath:i,pinFPaths:c,tagFPaths:l}=await o.A.listFPaths(!0),{linkMetas:f,inUseListNames:v}=(0,h.dG)(s,t,p),P=await(async(s,t)=>{let e,n,r=[];const{fpaths:i,ids:a}=(0,h.qO)(s);if(i.length>0){const s=await o.A.getFiles(i,!0),{fpaths:t,contents:n}=(0,h.jf)(s.fpaths,s.contents);for(let o=0;o<t.length;o++){const[s,c]=[t[o],n[o]];1!==t.length?r.push({...c,id:a[i.indexOf(s)],fpath:s}):e=c}}if(t){const{contents:s}=await o.A.getFiles([t],!0);(0,h.Gv)(s[0])&&(n=s[0])}(0,h.Gv)(e)&&!(0,h.Gv)(n)&&"purchases"in e&&(n={purchases:e.purchases,checkPurchasesDT:null},"checkPurchasesDT"in e&&(n.checkPurchasesDT=e.checkPurchasesDT)),(0,h.Gv)(e)&&("purchases"in e&&(e.purchases=null),"checkPurchasesDT"in e&&(e.checkPurchasesDT=null));for(const o of r)"purchases"in o&&(o.purchases=null),"checkPurchasesDT"in o&&(o.checkPurchasesDT=null);return{settings:e,conflictedSettings:r,info:n}})(r,i);let D;if(k.doFetchStgsAndInfo=!0,k.settings=P.settings,k.conflictedSettings=P.conflictedSettings,k.info=P.info,k.listNames=v,k.tagNames=(0,h.Vr)(f,l,y),k.settings&&(F=k.settings.doDescendingOrder),n){const e=(0,h.pZ)({linkFPaths:s,ssltFPaths:t,pendingSslts:p,links:a,doDescendingOrder:F,pinFPaths:c,pendingPins:g,tagFPaths:l,pendingTags:y,doForceLock:d,lockedLists:w,queryString:n});[D,m.hasMore]=[e.metas,e.hasMore]}else{const n=(0,h.FN)({linkFPaths:s,ssltFPaths:t,pendingSslts:p,links:a,listName:e,doDescendingOrder:F,pinFPaths:c,pendingPins:g});[D,m.hasMore]=[n.metas,n.hasMore]}for(const e of D)m.unfetchedLinkMetas.push(e);u.Ay.fetch.dt=Date.now()}const v=await f(m.unfetchedLinkMetas);return k.fetchedLinkMetas=m.fetchedLinkMetas,k.unfetchedLinkMetas=m.unfetchedLinkMetas,k.hasMore=m.hasMore,k.links=v.links,k},y=async s=>{const{getState:t,doForCompare:e,listName:n,queryString:r,lnOrQt:o,fthId:i,safLinkIds:a}=s,c=t().links,l=t().display.doForceLock,d=t().pendingSslts,p=t().pendingPins,g=t().pendingTags,y=t().settings.doDescendingOrder,w=t().lockSettings.lockedLists,F=(0,h.Xp)(t()),m=(0,h.ln)(t()),k=(0,h.w5)(t()),v=(0,h.x$)(t());let P;const D={fetchedLinkMetas:[],unfetchedLinkMetas:[],hasMore:!1,hasDisorder:!1};if(e)if(r)console.log("In blockstack.fetchMore, invalid doForCompare:",e,"with queryString:",r),[P,D.hasMore]=[[],!1];else{const s=(0,h.FN)({linkFPaths:F,ssltFPaths:m,pendingSslts:d,links:c,listName:n,doDescendingOrder:y,pinFPaths:k,pendingPins:p,excludingIds:a});P=s.metas,[D.hasMore,D.hasDisorder]=[s.hasMore,s.hasDisorder]}else if(r){const s=(0,h.pZ)({linkFPaths:F,ssltFPaths:m,pendingSslts:d,links:c,doDescendingOrder:y,pinFPaths:k,pendingPins:p,tagFPaths:v,pendingTags:g,doForceLock:l,lockedLists:w,queryString:r,excludingIds:a});P=s.metas,[D.hasMore,D.hasDisorder]=[s.hasMore,s.hasDisorder]}else{const s=(0,h.FN)({linkFPaths:F,ssltFPaths:m,pendingSslts:d,links:c,listName:n,doDescendingOrder:y,pinFPaths:k,pendingPins:p,excludingIds:a});P=s.metas,[D.hasMore,D.hasDisorder]=[s.hasMore,s.hasDisorder]}for(const f of P)(0,h.xn)(u.Ay.fetch.fetchedLinkIds,c,f.listName,f.id)?D.fetchedLinkMetas.push(f):D.unfetchedLinkMetas.push(f);const N=await f(D.unfetchedLinkMetas);return{doForCompare:e,lnOrQt:o,fthId:i,fetchedLinkMetas:D.fetchedLinkMetas,unfetchedLinkMetas:D.unfetchedLinkMetas,hasMore:D.hasMore,hasDisorder:D.hasDisorder,links:N.links}},w=async s=>{const{listNames:t,links:e}=s,n=[];for(let o=0;o<t.length;o++){const[s,r]=[t[o],e[o]],i=(0,h.u9)(s,r.id),a=(0,h.wg)(r,l.GlW);n.push({id:r.id,type:l.$tn,path:i,content:a})}const r=[],i=[],a=[],c=[],u=[],d={values:n,isSequential:!1,nItemsForNs:l.htT},f=await o.A.performFiles(d),p=(0,h.Vh)(f);for(let o=0;o<t.length;o++){const[s,n]=[t[o],e[o]],l=p[n.id];if((0,h.Gv)(l)&&l.success)r.push(s),i.push(n);else{let t=new Error("Error on previous dependent item");(0,h.Gv)(l)&&(t=new Error(l.error)),a.push(s),c.push(n),u.push(t)}}return{successListNames:r,successLinks:i,errorListNames:a,errorLinks:c,errors:u}},F=async s=>{const{listNames:t,links:e}=s;let n=Date.now();const r=[];for(let o=0;o<t.length;o++){const[s,i]=[t[o],e[o]],a=(0,h.CI)(s,n,n,i.id);r.push({id:i.id,type:l.$tn,path:a,content:{}}),n+=1}const i=[],a=[],c=[],u=[],d=[],f={values:r,isSequential:!1,nItemsForNs:l.htT},p=await o.A.performFiles(f),g=(0,h.Vh)(p);for(let o=0;o<t.length;o++){const[s,n]=[t[o],e[o]],r=g[n.id];if((0,h.Gv)(r)&&r.success)i.push(s),a.push(n);else{let t=new Error("Error on previous dependent item");(0,h.Gv)(r)&&(t=new Error(r.error)),c.push(s),u.push(n),d.push(t)}}return{successListNames:i,successLinks:a,errorListNames:c,errorLinks:u,errors:d}},m=async s=>{const{listNames:t,ids:e,fpathsPerId:n,prevFPathsPerId:r}=s,i=[];for(let o=0;o<t.length;o++){const[s,a]=[t[o],e[o]],c=[];for(const t of r[a])c.push({id:t,type:l.BCn,path:t,doIgnoreDoesNotExistError:!0});const u={values:c,isSequential:!1,nItemsForNs:l.htT},d=[];if((0,h.Gv)(n)&&Array.isArray(n[a]))for(const t of n[a])d.push({id:t,type:l.BCn,path:t,doIgnoreDoesNotExistError:!0});else{console.log(`In deleteLinks, for ${a}, invalid fpathsPerId`,n);const t=(0,h.u9)(s,a);d.push({id:a,type:l.BCn,path:t,doIgnoreDoesNotExistError:!0})}const f={values:[u,{values:d,isSequential:!1,nItemsForNs:l.htT}],isSequential:!0,nItemsForNs:l.htT};i.push(f)}const a=[],c=[],u=[],d=[],f=[],p={values:i,isSequential:!1,nItemsForNs:l.htT},g=await o.A.performFiles(p),y=(0,h.Vh)(g);for(let o=0;o<t.length;o++){const[s,r]=[t[o],e[o]];let i,l;if((0,h.Gv)(n)&&Array.isArray(n[r]))for(const t of n[r]){const s=y[t];if(!(0,h.Gv)(s)||!s.success){i=!1,l=new Error("Error on previous dependent item"),(0,h.Gv)(s)&&(l=new Error(s.error));break}i=!0}else{const s=y[r];(0,h.Gv)(s)&&s.success?i=!0:(i=!1,l=new Error("Error on previous dependent item"),(0,h.Gv)(s)&&(l=new Error(s.error)))}i?(a.push(s),c.push(r)):(u.push(s),d.push(r),f.push(l))}return{successListNames:a,successIds:c,errorListNames:u,errorIds:d,errors:f}},k=async s=>{const{toListNames:t,toLinks:e}=s,n=e.map((s=>s.url)),r=(await a.A.post(l.Mb6,{urls:n})).data.extractedResults;let o=Date.now();const i=[],c=[];for(let a=0;a<r.length;a++){const s=r[a];if(s.status===l.Jwu||s.status===l.pJM)continue;const[n,u]=[t[a],e[a]],d=`${(0,h.ju)(u.id)}-${(0,h.DU)(4)}-${o}`,f={...u,id:d,extractedResult:s,fromId:u.id};o+=1,i.push(n),c.push(f)}return{toListNames:t,toLinks:e,extractedListNames:i,extractedLinks:c,...await w({listNames:i,links:c})}},v=async s=>{const{dispatch:t,getState:e}=s,n=e().settings,r=e().snapshot.settings;if((0,h.n4)(n,r))return t({type:c.A2}),{};const o=n.doDescendingOrder!==r.doDescendingOrder;t({type:c.E5});try{const s=await P({settings:n});t({type:c.Ar,payload:{...s,doFetch:o}})}catch(i){t({type:c.fj,payload:{error:i}})}return{}},P=async s=>{const{settings:t}=s,{settingsFPaths:e}=await o.A.listFPaths(),n=Date.now(),{fpaths:r,ids:i}=(0,h.qO)(e),a=(0,h.Cd)(`${n}${(0,h.DU)(4)}`,i),c=(0,h.BK)(a),u={values:[{id:c,type:l.$tn,path:c,content:t}],isSequential:!1,nItemsForNs:l.htT},d=await o.A.performFiles(u);return(0,h.Uq)(u,d),{settings:t,_settingsFPaths:r}},D=async s=>{const{dispatch:t,getState:e}=s,n=e().info,r=e().snapshot.info;if((0,h.n4)(n,r))return t({type:c.JP}),{};t({type:c.zd});try{const s=await N({info:n});t({type:c.Bd,payload:{...s}})}catch(o){t({type:c.CZ,payload:{error:o}})}return{}},N=async s=>{const{info:t}=s,{infoFPath:e}=await o.A.listFPaths(),n=Date.now(),r=`${l.rDG}${n}${l.rWq}`,i={values:[{id:r,type:l.$tn,path:r,content:t}],isSequential:!1,nItemsForNs:l.htT},a=await o.A.performFiles(i);return(0,h.Uq)(i,a),{info:t,_infoFPath:e}},A=async s=>{const{getState:t,pins:e}=s,n=[],r={};for(const o of e){const s=(0,h.$h)(o.rank,o.updatedDT,o.addedDT,o.id);n.push({id:s,type:l.$tn,path:s,content:{}}),r[s]=o}const i={values:n,isSequential:!1,nItemsForNs:l.htT},a=await o.A.performFiles(i),c=(0,h.Vh)(a),u=[],d=[],f=[];for(const o in r){const[s,t]=[r[o],c[o]];if((0,h.Gv)(t)&&t.success)u.push(s);else{let e=new Error("Error on previous dependent item");(0,h.Gv)(t)&&(e=new Error(t.error)),d.push(s),f.push(e)}}const p=[],g=[];if(t){const s=t().pendingSslts,e=(0,h.Xp)(t()),n=(0,h.ln)(t()),{linkMetas:r}=(0,h.dG)(e,n,s),o=t().links;for(const{id:t}of u){const{listName:s,link:e}=(0,h.fn)(t,o);if(!(0,h.Kg)(s)||!(0,h.Gv)(e)){console.log("In putPins, no found listName or link for id:",t);continue}let n=!1;for(const o of r)if(o.listName===s&&o.id===t){n=!0;break}if(!n)continue;const[i,a]=[s,(0,h.wg)(e,l.GlW)];p.push(i),g.push(a)}}return{successPins:u,errorPins:d,errors:f,listNames:p,links:g}},S=async s=>{const{pins:t}=s,e=[],n={};for(const o of t){const s=(0,h.$h)(o.rank,o.updatedDT,o.addedDT,o.id);e.push({id:s,type:l.BCn,path:s,doIgnoreDoesNotExistError:!0}),n[s]=o}const r={values:e,isSequential:!1,nItemsForNs:l.htT},i=await o.A.performFiles(r),a=(0,h.Vh)(i),c=[],u=[],d=[];for(const o in n){const[s,t]=[n[o],a[o]];if((0,h.Gv)(t)&&t.success)c.push(s);else{let e=new Error("Error on previous dependent item");(0,h.Gv)(t)&&(e=new Error(t.error)),u.push(s),d.push(e)}}return{successPins:c,errorPins:u,errors:d}},I=async s=>{const{listName:t,fromLink:e,toLink:n}=s,{usedFPaths:r,serverUnusedFPaths:a,localUnusedFPaths:c}=(0,h.qM)(e.custom,n.custom),d=[],f=[];for(const o of r)if(u.Ay.platform.isReactNative)f.push({id:o,type:l.$tn,path:"file://"+o,content:""});else{const{content:s}=await i.A.getFile(o);f.push({id:o,type:l.$tn,path:o,content:s})}const p={values:f,isSequential:!1,nItemsForNs:l.htT};d.push(p);const g=(0,h.u9)(t,n.id),y=(0,h.wg)(n,l.GlW);d.push({id:g,type:l.$tn,path:g,content:y});const w={values:d,isSequential:!0,nItemsForNs:l.htT},F=await o.A.performFiles(w);return(0,h.Uq)(w,F),{listName:t,fromLink:e,toLink:n,serverUnusedFPaths:a,localUnusedFPaths:c}},L=async s=>{const{getState:t}=s,e=t().settings,n=t().snapshot.settings,r={};if(!(0,h.n4)(e,n)){const s=e.doDescendingOrder!==n.doDescendingOrder,t=await P({settings:e});r.doUpdateSettings=!0,r.settings=t.settings,r._settingsFPaths=t._settingsFPaths,r.doFetch=s}return r},M=(s,t,e,o)=>{const i={},a=[],c=[];if((0,h.Gv)(o[t]))for(const n of o[t].values)i[n.tagName]={...n,diffs:[]},a.push(n.tagName);for(const n of e)i[n.tagName]={...i[n.tagName],diffs:[]},c.push(n.tagName);const u=(0,n.nN)(a,c);for(const n of u){const[s,t]=[n[0],n[1]];i[t].diffs.push(s)}for(const r in i){const s=i[r].diffs;1===s.length&&s.includes(n.lw)?i[r].diffType=n.lw:1===s.length&&s.includes(n.Cm)?i[r].diffType=n.Cm:1===s.length&&s.includes(n.Ug)?i[r].diffType=n.Ug:2===s.length&&s.includes(n.Ug)&&s.includes(n.Cm)?i[r].diffType="DIFF_UPDATE":console.log("Found invalid diffs for tn:",r,s)}const d=[];for(const r of c){i[r].diffType!==n.lw?d.push(null):d.push(i[r].rank)}for(let n=0;n<d.length;n++){if((0,h.Kg)(d[n]))continue;let s,t,e;for(let r=n-1;r>=0;r--)if((0,h.Kg)(d[r])){s=d[r];break}for(let r=n+1;r<d.length;r++)if((0,h.Kg)(d[r])){t=d[r];break}if((0,h.Kg)(s)&&(0,h.Kg)(t)){const n=r.X.parse(`0|${s.replace("_",":")}`),o=r.X.parse(`0|${t.replace("_",":")}`);e=s===t?n:n.between(o)}else e=(0,h.Kg)(s)?r.X.parse(`0|${s.replace("_",":")}`).genNext():(0,h.Kg)(t)?r.X.parse(`0|${t.replace("_",":")}`).genPrev():r.X.middle();d[n]=e.toString().slice(2).replace(":","_")}for(let n=0;n<c.length;n++)i[c[n]].rank=d[n];let f=Date.now();const p=[],g=[];for(const r in i){const t=i[r];if(t.diffType===n.lw)continue;if(t.diffType===n.Cm){p.push(r);continue}const e=(0,h.Et)(t.addedDT)?t.addedDT:f,o=(0,h.I9)(r,t.rank,f,e,s);g.push({id:o,type:l.$tn,path:o,content:{}}),f+=1}return{deletedTagNames:p,pfValues:g}},$=async s=>{const{getState:t}=s;let{ids:e,valuesPerId:n}=s;Array.isArray(e)||(e=[s.id]),(0,h.Gv)(n)||(n={[s.id]:s.values});const r=(0,h.x$)(t()),i=(0,h.xF)(r,{}),a=[],c={},u={};for(const o of e){const[s,t]=[(0,h.ju)(o),n[o]],e=M(o,s,t,i);a.push(...e.pfValues),c[s]=e.pfValues,u[s]=e.deletedTagNames}for(const o of r){const s=(0,h.tF)(o),t=(0,h.ju)(s.id);if(Array.isArray(u[t])&&u[t].includes(s.tagName)){const s={id:o,type:l.BCn,path:o,doIgnoreDoesNotExistError:!0};a.push(s),Array.isArray(c[t])||(c[t]=[]),c[t].push(s)}}const d=[];for(let h=0;h<a.length;h+=800){const s={values:a.slice(h,h+800),isSequential:!1,nItemsForNs:l.htT},t=await o.A.performFiles(s);d.push(...t)}const f=(0,h.Vh)(d),p=[],g=[],y=[];for(const o of e){const s=(0,h.ju)(o);let t;for(const e of c[s]){const s=f[e.id];if(!(0,h.Gv)(s)||!s.success){t=new Error("Error on previous dependent item"),(0,h.Gv)(s)&&(t=new Error(s.error));break}}t?(g.push(o),y.push(t)):p.push(o)}return{valuesPerId:n,successIds:p,errorIds:g,errors:y}}},2443:(s,t,e)=>{e.d(t,{A:()=>E});var n=e(8790),r=e(1860),o=e(8090),i=e(7138),a=e(6177),c=e(8565),l=e(8159),h=e(8526);const u=c.A._userSession,d=(0,a.Hq)(),f=async(s,t)=>{const e={...s};if(Array.isArray(s.values)&&[!0,!1].includes(s.isSequential)){e.values=[];for(const n of s.values){const s=await f(n,t);e.values.push(s)}}else if((0,h.Kg)(s.id)&&(0,h.Kg)(s.type)&&(0,h.Kg)(s.path)){if(s.type===l.$tn){const n=new r.Z(s.content,null),i=await n.load(),a=n.wasString,c="hex";e.content=await(0,o.Nq)(t,i,a,c)}}else console.log("In encryptData, invalid data:",s);return e},p={performFiles:async s=>{const t=c.A.loadUserData();let{appPrivateKey:e,gaiaHubConfig:r}=t;if(!(0,h.Gv)(r)){const s=new n.w({userSession:u});r=await s.getOrSetLocalGaiaHubConnection()}const o=(0,i.sP)(e),a=await f(s,o),l=`${r.server}/perform-files/${r.address}`,p=await d(l,{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:`bearer ${r.token}`},body:JSON.stringify(a)});if(p.ok){return await p.json()}throw new Error(`(performFiles) Error ${p.status}`)}},g=p,y=s=>{let t=[];const e=(s,e)=>{for(const n of t)if(n.rId===s)return void([n.dt,n.nRequests]=[Date.now(),e]);t.push({rId:s,dt:Date.now(),nRequests:e})};return{respectLimit:async(n,r)=>{const o=s,i=6e4;let a=!1;for(let s=1;s<=4;s++){t=t.filter((s=>s.dt>=Date.now()-i));let c=0,l=Date.now(),u=!1;for(let s=t.length-1;s>=0;s--){const e=t[s];if(e.nRequests+c>=o){u=!0;break}c+=e.nRequests,l=e.dt}if(!u){e(n,r),a=!0;break}if(s<4){const s=(0,h.XM)([1e3,1500,2e3,2500,3e3,3500,4e3,4500,5e3]);let t=i-(Date.now()-l)+s;t<0&&(t=0),t>i+s&&(t=i+s),await(0,h.yy)(t)}}return a},updateNetworkInfos:e}};var w=e(8678);const F=c.A._userSession;let m,k;const v=async function(s,t){let e,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n?(k||(k=y(288)),e=k):(m||(m=y(w.Ay.user.hubUrl===l.MbX?144:72)),e=m),await e.respectLimit(s,t)},P=function(s,t){let e,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n?(k||(k=y(288)),e=k):(m||(m=y(w.Ay.user.hubUrl===l.MbX?144:72)),e=m),e.updateNetworkInfos(s,t)},D={dangerouslyIgnoreEtag:!0},N=async s=>{const t={...s};if(Array.isArray(s.values)&&[!0,!1].includes(s.isSequential)){t.values=[];for(const e of s.values){const s=await N(e);t.values.push(s)}}else(0,h.Kg)(s.id)&&(0,h.Kg)(s.type)&&(0,h.Kg)(s.path)?s.type===l.$tn&&s.path.endsWith(l.rWq)&&(t.content=JSON.stringify(s.content)):console.log("In stringifyData, invalid data:",s);return t},A=async s=>{if(Array.isArray(s.values)&&0===s.values.length)return[];const t=`${Date.now()}${(0,h.DU)(4)}`;await v(t,2);const e=await N(s),n=await g.performFiles(e);return await(async(s,t)=>{if(!(0,h.Gv)(w.QC.fpaths))return;const e=(0,h.sI)(w.QC.fpaths),n=(0,h.nw)(s);for(const r of t){if(!r.success)continue;const{type:t,path:o}=n[r.id];t===l.$tn?(0,h.J_)(e,o):t===l.BCn?(0,h.Z5)(e,o):console.log("In cacheData, invalid data:",s)}w.QC.fpaths=e})(s,n),P(t,2),n},S=async s=>{const{id:t,type:e,path:r}=s;if(e===l.$tn){const e=await async function(s,t){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:D;const r=`${Date.now()}${(0,h.DU)(4)}`;await v(r,2),s.endsWith(l.rWq)&&(t=JSON.stringify(t));const o=new n.w({userSession:F}),i=await o.putFile(s,t,e);if((0,h.Gv)(w.QC.fpaths)){const t=(0,h.sI)(w.QC.fpaths);(0,h.J_)(t,s),w.QC.fpaths=t}return P(r,2),i}(r,s.content);return{success:!0,id:t,publicUrl:e}}if(e===l.BCn){try{await async function(s){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const e=`${Date.now()}${(0,h.DU)(4)}`;await v(e,2);const r=new n.w({userSession:F}),o=await r.deleteFile(s,t);if((0,h.Gv)(w.QC.fpaths)){const t=(0,h.sI)(w.QC.fpaths);(0,h.Z5)(t,s),w.QC.fpaths=t}return P(e,2),o}(r)}catch(o){if(!((0,h.Gv)(o)&&(0,h.Kg)(o.message)&&(o.message.includes("failed to delete")&&o.message.includes("404")||o.message.includes("deleteFile Error")&&o.message.includes("GaiaError error 5")||o.message.includes("does_not_exist")||o.message.includes("file_not_found"))))throw o}return{success:!0,id:t}}throw new Error(`Invalid data.type: ${s.type}`)},I=async s=>{const t=[];if(Array.isArray(s.values)&&[!0,!1].includes(s.isSequential))if(s.isSequential)for(const n of s.values){const s=await I(n);if(t.push(...s),s.some((s=>!s.success)))break}else{let e=1;(0,h.Et)(s.nItemsForNs)&&(e=Math.min(s.nItemsForNs,l.htT));for(let n=0;n<s.values.length;n+=e){const r=s.values.slice(n,n+e),o=await Promise.all(r.map((s=>I(s))));for(const s of o)t.push(...s)}}else if((0,h.Kg)(s.id)&&(0,h.Kg)(s.type)&&(0,h.Kg)(s.path))try{const e=await S(s);t.push(e)}catch(e){t.push({error:e.toString().slice(0,999),success:!1,id:s.id})}else console.log("In nsPerformFiles, invalid data:",s);return t},L={cachedFPaths:w.QC,getFile:async function(s){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const e=`${Date.now()}${(0,h.DU)(4)}`;w.Ay.user.hubUrl===l.MbX?await v(e,1,!0):await v(e,1);const r=new n.w({userSession:F});let o=await r.getFile(s,t);return s.endsWith(l.rWq)&&(o=JSON.parse(o)),w.Ay.user.hubUrl===l.MbX?P(e,1,!0):P(e,1),o},performFiles:async s=>{let t;return t=w.Ay.user.hubUrl===l.MbX?await A(s):await I(s),t},listFiles:async s=>{const t=`${Date.now()}${(0,h.DU)(4)}`;await v(t,2);const e=new n.w({userSession:F}),r=await e.listFiles((t=>"auth/authTimestamp"===t||s(t))),o=w.Ay.user.hubUrl===l.MbX?2400:100;return P(t,Math.ceil(r/o)+1),r}},M=L;var $=e(427);const T=async s=>{const t={linkFPaths:{},ssltFPaths:[],staticFPaths:[],settingsFPaths:[],infoFPath:null,pinFPaths:[],tagFPaths:[]};return await s((s=>((0,h.J_)(t,s),!0))),t},E={listFPaths:async function(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(0,h.Gv)(M.cachedFPaths.fpaths)&&!s||(M.cachedFPaths.fpaths=await T(M.listFiles)),M.cachedFPaths.fpaths},getFiles:async function(s){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const e={responses:[],fpaths:[],contents:[]},n=[];for(const r of s){let s;[l.Aak,l.cPx,l.yyQ,l.rDG,l.$xt,l.gpL].some((s=>r.startsWith(s)))&&(s=await $.A.getFile(r,!0)),void 0!==s?(e.responses.push({content:s,fpath:r,success:!0}),e.fpaths.push(r),e.contents.push(s)):n.push(r)}for(let r=0;r<n.length;r+=l.htT){const s=n.slice(r,r+l.htT),o=await(0,h.lL)(M.getFile,s,0,t);for(const t of o)if(e.responses.push(t),e.fpaths.push(t.fpath),e.contents.push(t.content),t.success){const{fpath:s,content:e}=t;[l.Aak,l.cPx,l.yyQ,l.rDG,l.$xt,l.gpL].some((t=>s.startsWith(t)))&&await $.A.putFile(s,e)}}return e},performFiles:async s=>{const t=await M.performFiles(s),e=(0,h.nw)(s);for(const n of t){if(!n.success)continue;const{type:t,path:r,content:o}=e[n.id];[l.Aak,l.cPx,l.yyQ,l.rDG,l.$xt,l.gpL].some((s=>r.startsWith(s)))&&(t===l.$tn?await $.A.putFile(r,o):t===l.BCn?await $.A.deleteFile(r):console.log("In dataApi.performFiles, invalid data:",s))}return t}}},1769:(s,t,e)=>{e.d(t,{A:()=>r});var n=e(1407);const r={post:(s,t)=>n.A.post(s,t)}}}]);