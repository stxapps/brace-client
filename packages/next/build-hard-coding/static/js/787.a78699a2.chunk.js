"use strict";(self.webpackChunkbrace_client_web=self.webpackChunkbrace_client_web||[]).push([[787],{1787:(t,e,s)=>{s.r(e),s.d(e,{addLink:()=>U,addListNames:()=>tt,addLockList:()=>_t,addSelectedLinkIds:()=>N,addTagEditorTagName:()=>zt,addTagNames:()=>re,cancelDiedLinks:()=>X,cancelDiedPins:()=>Tt,cancelDiedSettings:()=>gt,cancelDiedTags:()=>ae,changeListName:()=>m,checkDeleteListName:()=>at,checkDeleteTagName:()=>pe,cleanUpLinks:()=>J,cleanUpPins:()=>bt,cleanUpSslts:()=>x,cleanUpStaticFiles:()=>V,cleanUpTags:()=>ie,deleteLinks:()=>K,deleteListNames:()=>it,deleteOldLinksInTrash:()=>H,deleteSelectedLinkIds:()=>A,deleteTagNames:()=>ue,extractContents:()=>R,fetch:()=>S,fetchMore:()=>F,lockCurrentList:()=>Bt,mergeSettings:()=>kt,mergeSettingsDeleteStep:()=>wt,moveLinks:()=>Q,moveListName:()=>st,movePinnedLink:()=>Et,moveTagName:()=>ce,moveToListName:()=>nt,pinLinks:()=>St,randomHouseworkTasks:()=>B,removeLockList:()=>Wt,retryDiedLinks:()=>q,retryDiedPins:()=>Mt,retryDiedSettings:()=>ht,retryDiedTags:()=>ne,runAfterFetchTask:()=>W,showAddLockEditorPopup:()=>Rt,tryUpdateExtractedContents:()=>_,tryUpdateFetched:()=>T,tryUpdateFetchedMore:()=>O,tryUpdateInfo:()=>mt,unlockList:()=>Ht,unpinLinks:()=>Pt,updateBulkEditMenuMode:()=>ye,updateCustomData:()=>xt,updateCustomDataDeleteStep:()=>Kt,updateCustomEditor:()=>Ut,updateCustomEditorPopup:()=>jt,updateDeleteAction:()=>At,updateDiscardAction:()=>Lt,updateDoDeleteOldLinksInTrash:()=>rt,updateDoDescendingOrder:()=>lt,updateDoExtractContents:()=>ot,updateDoUseLocalLayout:()=>vt,updateDoUseLocalTheme:()=>Ft,updateFetched:()=>b,updateFetchedMore:()=>G,updateHubAddr:()=>g,updateImages:()=>Qt,updateInfoDeleteStep:()=>ft,updateLayoutType:()=>Nt,updateLinkEditor:()=>w,updateListNameEditors:()=>z,updateListNames:()=>et,updateListNamesMode:()=>It,updateLockAction:()=>qt,updateLockEditor:()=>Xt,updatePaywallFeature:()=>Dt,updateQueryString:()=>k,updateSelectingLinkId:()=>L,updateSelectingListName:()=>ct,updateSelectingTagName:()=>fe,updateSettingsDeleteStep:()=>pt,updateSettingsPopup:()=>Y,updateSettingsViewId:()=>Z,updateStatus:()=>v,updateStgsAndInfo:()=>yt,updateTagData:()=>te,updateTagDataTStep:()=>se,updateTagEditor:()=>Zt,updateTagEditorPopup:()=>Yt,updateTagNameColor:()=>de,updateTagNameEditors:()=>oe,updateTagNames:()=>le,updateTheme:()=>Ot,updateThemeCustomOptions:()=>$t,updateTimePick:()=>Ct,updateUpdatingThemeMode:()=>Gt});var n=s(3704),a=s(8565),i=s(1769),o=s(2443),r=s(8583),l=s(629),c=s(8103),d=s(8159),p=s(8526),u=s(1930),f=s(8678),y=s(8862),h=s(1701);const g=()=>(t,e)=>{try{e().user.hubUrl===d.THB&&t((0,y.e5)(d.ITW,!0));const s=a.A.loadUserData(),n=(0,p.K4)(s);t({type:c.E8,payload:{hubAddr:n}})}catch(s){console.log("updateHubAddr error:",s)}},m=t=>async(e,s)=>{e(b(null,!1,!0)),e(G(null,!0)),e({type:c.IN,payload:t})},k=t=>async(e,s)=>{e(b(null,!1,!0)),e(G(null,!0)),e({type:c.pM,payload:t})},w=t=>({type:c.tx,payload:t}),v=t=>({type:c.t5,payload:t}),N=t=>({type:c.ct,payload:t}),A=t=>({type:c._d,payload:t}),L=t=>({type:c.g3,payload:t}),I=async t=>{const e=[],s=[],n={};for(const a of t)if(e.push(a.id),(0,p.Gv)(a.custom)){const{image:t}=a.custom;(0,p.Kg)(t)&&t.startsWith(d.d91+"/")&&(s.includes(t)||s.push(t))}for(const a of s){const{contentUrl:t}=await r.A.getFile(a);(0,p.Kg)(t)&&(n[a]=t)}return{ids:e,images:n}},D=async(t,e)=>{const s=[],n=[],a={};for(const i of t){const{listName:t,id:a}=i;let o;if((0,p.Gv)(e[t])&&(o=e[t][a]),(0,p.Gv)(o)&&(s.push(o.id),(0,p.Gv)(o.custom))){const{image:t}=o.custom;(0,p.Kg)(t)&&t.startsWith(d.d91+"/")&&(n.includes(t)||n.push(t))}}for(const i of n){const{contentUrl:t}=await r.A.getFile(i);(0,p.Kg)(t)&&(a[i]=t)}return{ids:s,images:a}},S=()=>async(t,e)=>{const s=f.Ay.fetch.doForce;f.Ay.fetch.doForce=!1;const n=e().links,a=e().display.listName,i=e().display.queryString,o=e().display.didFetch,r=e().display.didFetchSettings,l=e().display.fetchingInfos,d=e().display.doForceLock,u=e().fetched,y=e().pendingSslts,h=e().pendingPins,g=e().pendingTags,m=e().lockSettings.lockedLists;let k=e().settings.doDescendingOrder;const w=(0,p.Xp)(e()),v=(0,p.ln)(e()),N=(0,p.w5)(e()),A=(0,p.x$)(e()),L=i||a;if((0,p.ct)(L,s,l)||L in u){if(!i&&!f.Ay.fetch.doShowLoading){const{hasMore:e,objsWithPcEc:s}=(0,p.H1)({links:n,listName:a,doDescendingOrder:k,pinFPaths:N,pendingPins:h}),{ids:i,images:o}=await I(s);t({type:c.$p,payload:{ids:i,hasMore:e,images:o,doClearSelectedLinkIds:!0}})}return void(f.Ay.fetch.doShowLoading=!1)}const S=`${Date.now()}${(0,p.DU)(4)}`;t($({type:c.tH,doForce:s,lnOrQt:L,fthId:S}));const P={fetchedLinkMetas:[],unfetchedLinkMetas:[],hasMore:!1};if(o&&r){let e,s;if(i){const t=(0,p.pZ)({linkFPaths:w,ssltFPaths:v,pendingSslts:y,links:n,doDescendingOrder:k,pinFPaths:N,pendingPins:h,tagFPaths:A,pendingTags:g,doForceLock:d,lockedLists:m,queryString:i});[e,s]=[t.metas,t.metasWithPcEc],P.hasMore=t.hasMore}else{const t=(0,p.FN)({linkFPaths:w,ssltFPaths:v,pendingSslts:y,links:n,listName:a,doDescendingOrder:k,pinFPaths:N,pendingPins:h});[e,s]=[t.metas,t.metasWithPcEc],P.hasMore=t.hasMore}for(const t of e)(0,p.xn)(f.Ay.fetch.fetchedLinkIds,n,t.listName,t.id)?P.fetchedLinkMetas.push(t):P.unfetchedLinkMetas.push(t);if(0===P.unfetchedLinkMetas.length){const{ids:e,images:i}=await D(s,n),o={ids:e,hasMore:P.hasMore,images:i,doClearSelectedLinkIds:!0};return L===a&&0===P.fetchedLinkMetas.length&&(o.listNameToClearLinks=L),t({type:c.$p,payload:o}),(0,p.Q2)(L,null,f.Ay),t(j(S)),void(f.Ay.fetch.doShowLoading=!1)}}if(!i&&!f.Ay.fetch.doShowLoading){const{hasMore:e,objsWithPcEc:s}=(0,p.H1)({links:n,listName:a,doDescendingOrder:k,pinFPaths:N,pendingPins:h}),{ids:i,images:o}=await I(s);t({type:c.$p,payload:{ids:i,hasMore:e,images:o,doClearSelectedLinkIds:!0}})}f.Ay.fetch.doShowLoading=!1;const E={listName:a,queryString:i,lnOrQt:L,fthId:S};t({type:c.tH,payload:E,meta:{offline:{effect:{method:c.tH,params:{...E,getState:e}},commit:{type:c.X7},rollback:{type:c.Ed,meta:{...E,signInDT:e().localSettings.signInDT}}}}})},P=(t,e,s)=>t.map((t=>{const{listName:n,id:a}=t;let i=e;return(0,p.Gv)(i[n])&&(0,p.Gv)(i[n][a])?i[n][a]:(i=s,(0,p.Gv)(i[n])&&(0,p.Gv)(i[n][a])?i[n][a]:null)})),E=(t,e,s)=>t.map((t=>{const{listName:n,id:a}=t;let i=e;return(0,p.Gv)(i[n])&&(0,p.Gv)(i[n][a])?{listName:n,link:i[n][a]}:(i=s,(0,p.Gv)(i[n])&&(0,p.Gv)(i[n][a])?{listName:n,link:i[n][a]}:{listName:null,link:null})})),M=t=>{const e=[],s=[];for(const n of t){if(!(0,p.Gv)(n))continue;const t=(0,p.ju)(n.id);s.includes(t)||(e.push(n),s.push(t))}return e},T=t=>async(e,s)=>{e(g());const n=s().display.listName,a=s().display.queryString,i=s().display.fetchingInfos;if((0,p.zN)(t.fthId,i))return void e(j(t.fthId));const o=a||n;if(t.lnOrQt!==o)return e(b(t,!1,!0)),void e(j(t.fthId));const r=((t,e)=>{const s=t().display.fetchingInfos,n=t().display.showingLinkIds,a=t().pendingPins,i=t().fetchedMore,o=t().settings.doDescendingOrder,r=(0,p.w5)(t());if(!Array.isArray(n)||0===n.length)return 0;if((0,p.TJ)(e.lnOrQt,!1,s)||(0,p.TJ)(e.lnOrQt,!0,s)||e.lnOrQt in i)return 3;const l=[],c=[],u=n.map((e=>(0,p.TE)(e,t().links)));for(const m of u)(0,p.Gv)(m)&&(d.VRb.includes(m.status)&&l.push(m),m.status===d.jjN&&c.push(m));if(0===l.length)return 0;const{fetchedLinkMetas:f,unfetchedLinkMetas:y}=e,h=[...f,...y];let g=P(h,e.links,t().links);if(g=M(g),g=(0,p.My)(g,o),g=(0,p.sF)(g,r,a,(t=>(0,p.ju)(t.id))),c.length<g.length)return 3;if(c.length>g.length&&!e.hasMore)return 3;for(let d=0;d<g.length;d++){const[t,e]=[c[d],g[d]];if(t.id!==e.id||!(0,p.n4)(t.extractedResult,e.extractedResult)||!(0,p.n4)(t.custom,e.custom)||t.doIgnoreExtrdRst)return 3}return c.length>g.length?2:1})(s,t);if(0===r)return e(b(t)),void e(j(t.fthId));if(1===r){const n=s().display.showingLinkIds;return e({type:c.EQ,payload:{lnOrQt:t.lnOrQt,keepIds:n,hasMore:t.hasMore}}),(0,p.Q2)(t.lnOrQt,t.links,f.Ay),void e(j(t.fthId))}if(2===r)return(0,p.Q2)(null,t.links,f.Ay),e(j(t.fthId)),void e(F(!0));if(!s().display.isBulkEditing){if(f.Ay.scrollPanel.scrollY<32&&!(0,y.Kz)(s()))return e(b(t)),void e(j(t.fthId))}e({type:c.pV,payload:t}),e(j(t.fthId))},b=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return async(n,a)=>{if(!t){const e=a().display.listName,s=a().display.queryString,n=s||e,i=a().fetched[n];i&&({payload:t}=i)}if(!t)return;const i=a().links,o=a().pendingPins,r=a().settings.doDescendingOrder,l=(0,p.w5)(a()),{fetchedLinkMetas:u,unfetchedLinkMetas:y}=t,h=[...u,...y],g=E(h,t.links,i),m={},k=[];for(const{listName:t,link:e}of g)(0,p.Kg)(t)&&(0,p.Gv)(e)&&((0,p.Gv)(m[t])||(m[t]={}),m[t][e.id]=e,k.push(e));if(s)return n({type:c.EQ,payload:{lnOrQt:t.lnOrQt,links:m}}),void(0,p.Q2)(t.lnOrQt,t.links,f.Ay);const w=[];if((0,p.Gv)(i[t.lnOrQt]))for(const e of Object.values(i[t.lnOrQt]))[d.jjN,d.cir,d.eNM].includes(e.status)||w.push(e);let v=[...w,...k];v=M(v),v=(0,p.My)(v,r),v=(0,p.sF)(v,l,o,(t=>(0,p.ju)(t.id)));const{ids:N,images:A}=await I(v);n({type:c.EQ,payload:{lnOrQt:t.lnOrQt,links:m,ids:N,hasMore:t.hasMore,images:A,doChangeListCount:e,doClearSelectedLinkIds:!0}}),(0,p.Q2)(t.lnOrQt,t.links,f.Ay)}},F=function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return async(e,s)=>{const n=s().links,a=s().display.listName,i=s().display.queryString,o=s().display.fetchingInfos,r=s().display.showingLinkIds,l=s().display.doForceLock,d=s().fetchedMore,u=s().pendingSslts,y=s().pendingPins,h=s().pendingTags,g=s().lockSettings.lockedLists,m=s().settings.doDescendingOrder,k=(0,p.Xp)(s()),w=(0,p.ln)(s()),v=(0,p.w5)(s()),N=(0,p.x$)(s());if(!Array.isArray(r))return void console.log("In fetchMore, showingLinkIds is not an array!");const A=i||a;if((0,p.TJ)(A,t,o)||A in d)return;const L=`${Date.now()}${(0,p.DU)(4)}`;e($({type:c.Dx,doForCompare:t,lnOrQt:A,fthId:L}));let S=!1;t||i||(S=!f.Ay.fetch.fetchedLnOrQts.includes(a));const P=[],E=r.map((t=>(0,p.TE)(t,n)));for(const t of E)(0,p.Gv)(t)&&f.Ay.fetch.fetchedLinkIds.includes(t.id)&&P.push(t.id);const M={fetchedLinkMetas:[],unfetchedLinkMetas:[],hasMore:!1,hasDisorder:!1};if(t){if(i)return(0,p.Q2)(A,null,f.Ay),void e(j(L));if(0===(0,p.FN)({linkFPaths:k,ssltFPaths:w,pendingSslts:u,links:n,listName:a,doDescendingOrder:m,pinFPaths:v,pendingPins:y,excludingIds:P}).metas.length)return(0,p.Q2)(A,null,f.Ay),void e(j(L))}else{let t,s;if(i){if(S)return void e(j(L));const a=(0,p.pZ)({linkFPaths:k,ssltFPaths:w,pendingSslts:u,links:n,doDescendingOrder:m,pinFPaths:v,pendingPins:y,tagFPaths:N,pendingTags:h,doForceLock:l,lockedLists:g,queryString:i,excludingIds:P});[t,s]=[a.metas,a.metasWithPcEc],[M.hasMore,M.hasDisorder]=[a.hasMore,a.hasDisorder]}else{if(S){const{hasMore:t,hasDisorder:s,objsWithPcEc:i}=(0,p.H1)({links:n,listName:a,doDescendingOrder:m,pinFPaths:v,pendingPins:y,excludingIds:r});s&&console.log("No cache for now. Maybe fast enough to not jumpy.");const{ids:o,images:l}=await I(i);return e({type:c.$p,payload:{ids:o,hasMore:t,images:l}}),void e(j(L))}const i=(0,p.FN)({linkFPaths:k,ssltFPaths:w,pendingSslts:u,links:n,listName:a,doDescendingOrder:m,pinFPaths:v,pendingPins:y,excludingIds:P});[t,s]=[i.metas,i.metasWithPcEc],[M.hasMore,M.hasDisorder]=[i.hasMore,i.hasDisorder]}for(const e of t)(0,p.xn)(f.Ay.fetch.fetchedLinkIds,n,e.listName,e.id)?M.fetchedLinkMetas.push(e):M.unfetchedLinkMetas.push(e);if(0===M.unfetchedLinkMetas.length){M.hasDisorder&&console.log("No cache for now. Maybe fast enough to not jumpy.");const{ids:t,images:a}=await D(s,n);return e({type:c.$p,payload:{ids:t,hasMore:M.hasMore,images:a}}),void e(j(L))}}const T={doForCompare:t,listName:a,queryString:i,lnOrQt:A,fthId:L,safLinkIds:P};e({type:c.Dx,payload:T,meta:{offline:{effect:{method:c.Dx,params:{...T,getState:s}},commit:{type:c.bK},rollback:{type:c.sO,meta:T}}}})}},O=t=>async(e,s)=>{const n=s().display.listName,a=s().display.queryString,i=s().display.fetchingInfos,o=s().display.showingLinkIds;if((0,p.zN)(t.fthId,i)||!Array.isArray(o))return void e(j(t.fthId));const r=a||n;if(t.lnOrQt!==r)return e(G(t,!0)),void e(j(t.fthId));if(t.doForCompare){const{ossLinks:n,npfLinks:a,updatingLinks:i,toLnMap:r}=((t,e)=>{const s=t().display.showingLinkIds,n=t().pendingPins,a=t().settings.doDescendingOrder,i=(0,p.w5)(t()),o=[],r=[],l={};if(Array.isArray(s)){const e=s.map((e=>(0,p.fn)(e,t().links)));for(const{listName:t,link:s}of e)(0,p.Kg)(t)&&(0,p.Gv)(s)&&(d.VRb.includes(s.status)&&o.push(s),s.status===d.jjN&&r.push(s),l[s.id]=t)}const{fetchedLinkMetas:c,unfetchedLinkMetas:u}=e,y=[...c,...u],h=E(y,e.links,t().links);let g=[];for(const{listName:d,link:f}of h)(0,p.Kg)(d)&&(0,p.Gv)(f)&&(g.push(f),l[f.id]=d);for(const d of r)f.Ay.fetch.fetchedLinkIds.includes(d.id)&&g.push(d);return g=M(g),g=(0,p.My)(g,a),g=(0,p.sF)(g,i,n,(t=>(0,p.ju)(t.id))),{ossLinks:o,npfLinks:r,updatingLinks:g,toLnMap:l}})(s,t),l=((t,e,s,n)=>{if(0===t.length)return 0;if(e.length<s.length)return 3;if(e.length>s.length&&!n)return 3;for(let a=0;a<s.length;a++){const[t,n]=[e[a],s[a]];if(t.id!==n.id||!(0,p.n4)(t.extractedResult,n.extractedResult)||!(0,p.n4)(t.custom,n.custom)||t.doIgnoreExtrdRst)return 3}return e.length>s.length?2:1})(n,a,i,t.hasMore);if(0===l)return e(G(t)),void e(j(t.fthId));if(1===l)return e({type:c.uT,payload:{lnOrQt:t.lnOrQt,keepIds:o,hasMore:t.hasMore}}),(0,p.Q2)(t.lnOrQt,t.links,f.Ay),void e(j(t.fthId));if(2===l)return(0,p.Q2)(null,t.links,f.Ay),e(j(t.fthId)),void e(F(!0));const{metas:u,lksPerLn:y}=((t,e)=>{const s=[],n={};for(const a of t){const{id:t}=a,{addedDT:i,updatedDT:o}=(0,p.Bj)(t),r=e[t];s.push({id:t,addedDT:i,updatedDT:o,fpaths:[],listName:r}),(0,p.Gv)(n[r])||(n[r]={}),n[r][t]=a}return{metas:s,lksPerLn:n}})(i,r);return e({type:c.pV,payload:{lnOrQt:t.lnOrQt,fetchedLinkMetas:[],unfetchedLinkMetas:u,hasMore:t.hasMore,links:y}}),void e(j(t.fthId))}if(!t.hasDisorder)return e(G(t)),void e(j(t.fthId));if(!s().display.isBulkEditing){const n=f.Ay.scrollPanel.contentHeight;if(f.Ay.scrollPanel.layoutHeight+f.Ay.scrollPanel.scrollY>.96*n&&!(0,y.Kz)(s()))return e(G(t)),void e(j(t.fthId))}e({type:c.Bc,payload:t}),e(j(t.fthId))},G=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return async(s,n)=>{if(!t){const e=n().display.listName,s=n().display.queryString,a=s||e,i=n().fetchedMore[a];i&&({payload:t}=i)}if(!t)return;const a=n().links,i=n().display.showingLinkIds,o=n().pendingPins,r=n().settings.doDescendingOrder,l=(0,p.w5)(n());if(!Array.isArray(i))return void s({type:c.uT,payload:{lnOrQt:t.lnOrQt}});if(e)return s({type:c.uT,payload:{lnOrQt:t.lnOrQt,links:t.links}}),void(0,p.Q2)(t.lnOrQt,t.links,f.Ay);const u=[];if((0,p.Gv)(a[t.lnOrQt]))for(const e of Object.values(a[t.lnOrQt]))[d.jjN,d.cir,d.eNM].includes(e.status)||u.push(e);let y=i.map((t=>(0,p.TE)(t,a)));y=y.filter((t=>(0,p.Gv)(t)));const{fetchedLinkMetas:h,unfetchedLinkMetas:g}=t,m=[...h,...g];let k=P(m,t.links,a);k=k.filter((t=>(0,p.Gv)(t)));let w=[...u,...k,...y];w=M(w),w=(0,p.My)(w,r),w=(0,p.sF)(w,l,o,(t=>(0,p.ju)(t.id)));const{ids:v,images:N}=await I(w);s({type:c.uT,payload:{lnOrQt:t.lnOrQt,links:t.links,ids:v,hasMore:t.hasMore,images:N}}),(0,p.Q2)(t.lnOrQt,t.links,f.Ay)}},C=async(t,e)=>{const s=e().links,n=e().display.showingLinkIds,a=e().pendingPins,i=e().settings.doDescendingOrder,o=(0,p.w5)(e());if(!Array.isArray(n))return;let r=n.map((t=>(0,p.TE)(t,s)));r=M(r),r=(0,p.My)(r,i),r=(0,p.sF)(r,o,a,(t=>(0,p.ju)(t.id)));const l=r.map((t=>t.id));t({type:c.$p,payload:{ids:l}})},$=t=>({type:c.M0,payload:t}),j=t=>({type:c.oL,payload:t}),U=(t,e,s)=>async(n,a)=>{(0,p.Kg)(e)||(e=a().display.listName),e===d.tA0&&(e=d.IRu);const o=a().display.queryString;o&&(e=d.IRu);const r=Date.now(),l=`${r}-${(0,p.DU)(4)}-${(0,p.DU)(4)}`,u=(0,p.vm)((0,p._l)(t)),y={id:l,url:t,addedDT:r,decor:u};let h;o||e!==a().display.listName||(h=(t=>{const e=t().display.showingLinkIds,s=t().settings.doDescendingOrder;if(!Array.isArray(e))return null;if(!s)return e.length;const n=(0,p.w5)(t()),a=t().pendingPins,i=(0,p.L)(n,a,!0);for(let o=0;o<e.length;o++)if(!((0,p.ju)(e[o])in i))return o;return e.length})(a));const g={listNames:[e],links:[y],insertIndex:h};!1===s&&!0===a().settings.doExtractContents&&i.A.post(d.Ody,{urls:[t]}).then((()=>{})).catch((e=>{console.log("Error when contact Brace server to pre-extract contents with url: ",t," Error: ",e)})),n({type:c.qP,payload:g,meta:{offline:{effect:{method:c.qP,params:g},commit:{type:c.OJ,meta:{doExtractContents:s}},rollback:{type:c.NJ,meta:g}}}}),(0,p.Q2)(null,[y],f.Ay)},Q=(t,e)=>async(s,n)=>{if(0===e.length)return;const a=n().links,i=[],o=[];for(const l of e){const{listName:e,link:s}=(0,p.fn)(l,a);if(!(0,p.Kg)(e)||!(0,p.Gv)(s)){console.log("In moveLinks, no found list name or link for id:",l);continue}const[n,r]=[e,(0,p.wg)(s,d.GlW)];if(n===t){console.log("In moveLinks, same fromListName and toListName:",n);continue}const c={...r,fromListName:n,fromId:r.id};i.push(t),o.push(c)}const r={listNames:i,links:o};s({type:c.lw,payload:r,meta:{offline:{effect:{method:c.lw,params:r},commit:{type:c.Ls,meta:r},rollback:{type:c.wg,meta:r}}}}),(0,p.Q2)(null,o,f.Ay)},x=()=>async(t,e)=>{const s=(0,p.Xp)(e()),n=(0,p.ln)(e()),{linkMetas:a,ssltInfos:i}=(0,p.dG)(s,n,{}),r=(0,p.yY)(a);let l=d.htT;e().user.hubUrl===d.MbX&&(l=60);const c=[];for(const o of n){const{id:t}=(0,p.ds)(o),e=(0,p.ju)(t);if((!(0,p.Kg)(e)||!r.includes(e)||!(0,p.Gv)(i[e])||o!==i[e].fpath)&&(c.push({id:o,type:d.BCn,path:o,doIgnoreDoesNotExistError:!0}),c.length>=l))break}if(0!==c.length)try{const t={values:c,isSequential:!1,nItemsForNs:d.htT};await o.A.performFiles(t)}catch(u){console.log("cleanUpSslts error: ",u)}},K=t=>async(e,s)=>{const n=s().links,a=s().pendingSslts,i=(0,p.Xp)(s()),o=(0,p.ln)(s()),{linkMetas:r,prevFPathsPerMids:l}=(0,p.dG)(i,o,a),d=[],u=[],f={},y={};for(const c of t){const{listName:t,link:e}=(0,p.fn)(c,n);if(!(0,p.Kg)(t)||!(0,p.Gv)(e)){console.log("In deleteLinks, no found list name or link for id:",c);continue}const s=r.find((t=>t.id===c));if(!(0,p.Gv)(s)){console.log("In deleteLinks, no found meta for id:",c);continue}const a=s.fpaths,i=l[(0,p.ju)(c)];Array.isArray(f[c])||(f[c]=[]),Array.isArray(y[c])||(y[c]=[]),d.push(t),u.push(c),Array.isArray(a)&&f[c].push(...a),Array.isArray(i)&&y[c].push(...i)}if(0===u.length)return;const h={listNames:d,ids:u,fpathsPerId:f,prevFPathsPerId:y};e({type:c.U7,payload:h,meta:{offline:{effect:{method:c.U7,params:h},commit:{type:c.Al},rollback:{type:c.$V,meta:h}}}})},q=t=>async(e,s)=>{const n=s().links;for(const a of t){const{listName:t,link:s}=(0,p.fn)(a,n);if(!(0,p.Kg)(t)||!(0,p.Gv)(s)){console.log("In retryDiedLinks, no found listName or link for id:",a);continue}const{status:i}=s;if(i===d.X9C){const n={listNames:[t],links:[(0,p.wg)(s,d.GlW)]};e({type:c.qP,payload:n,meta:{offline:{effect:{method:c.qP,params:n},commit:{type:c.OJ},rollback:{type:c.NJ,meta:n}}}})}else if(i===d.o25){const n={listNames:[t],links:[s],didRetry:!0};e({type:c.lw,payload:n,meta:{offline:{effect:{method:c.lw,params:n},commit:{type:c.Ls,meta:n},rollback:{type:c.wg,meta:n}}}})}else if(i===d.jOu)e(K([a]));else if(i===d.qgH)e(K([a]));else{if(i!==d.Qc5)throw new Error(`Invalid status: ${i} of id: ${a}`);{const n={listName:t,fromLink:s.fromLink,toLink:s};e({type:c.jk,payload:n,meta:{offline:{effect:{method:c.jk,params:n},commit:{type:c.hK},rollback:{type:c.AN,meta:n}}}})}}}},X=t=>async(e,s)=>{const n=s().links,a=[],i=[],o=[],r=[];for(const c of t){const{listName:t,link:e}=(0,p.fn)(c,n);if(!(0,p.Kg)(t)||!(0,p.Gv)(e)){console.log("In cancelDiedLinks, no found listName or link for id:",c);continue}const{status:s,fromId:l,fromLink:d}=e;a.push(t),i.push(c),o.push(s),r.push((0,p.Kg)(l)?l:(0,p.Gv)(d)?d.id:null)}const l={listNames:a,ids:i,statuses:o,fromIds:r};e({type:c.q8,payload:l})},R=(t,e)=>async(s,n)=>{if(!n().settings.doExtractContents)return void s(W());if(n().display.isBulkEditing)return;const{toListNames:a,toLinks:i}=((t,e,s)=>{const n=t().links,a=t().pendingSslts,i=(0,p.Xp)(t()),o=(0,p.ln)(t()),{linkMetas:r}=(0,p.dG)(i,o,a),[l,c]=[Array.isArray(e),Array.isArray(s)],u=[],f=[];if(l&&c){for(let t=0;t<e.length;t++){const[a,i]=[e[t],s[t]];if(a===d.tA0)continue;if(!(0,p.Gv)(n[a])||!(0,p.Gv)(n[a][i]))continue;const o=n[a][i];if(o.status!==d.jjN)continue;if((0,p.Gv)(o.custom))continue;if((0,p.Gv)(o.extractedResult)&&o.extractedResult.status!==d.Jwu)continue;if((0,p.wv)(o.url)!==d.Low)continue;if(!r.some((t=>t.listName===a&&t.id===o.id)))continue;const[l,c]=[a,(0,p.wg)(o,d.GlW)];if(u.push(l),f.push(c),f.length>=d.htT)break}return{toListNames:u,toLinks:f}}const y=t().display.listName;if(y===d.tA0||!(0,p.Gv)(n[y]))return{toListNames:u,toLinks:f};const h=Object.values(n[y]).sort(((t,e)=>e.addedDT-t.addedDT));for(const g of h){if(g.status!==d.jjN)continue;if((0,p.Gv)(g.custom))continue;if((0,p.Gv)(g.extractedResult)&&g.extractedResult.status!==d.Jwu)continue;if((0,p.wv)(g.url)!==d.Low)continue;if(!r.some((t=>t.listName===y&&t.id===g.id)))continue;const[t,e]=[y,(0,p.wg)(g,d.GlW)];if(u.push(t),f.push(e),f.length>=d.htT)break}return{toListNames:u,toLinks:f}})(n,t,e);if(0===i.length)return void s(W());const o=n().display.selectingLinkId;if(i.some((t=>t.id===o))&&(0,y.Kz)(n()))return;const r={toListNames:a,toLinks:i};s({type:c.ds,payload:r,meta:{offline:{effect:{method:c.ds,params:r},commit:{type:c.pZ},rollback:{type:c.G3,meta:r}}}})},_=t=>async(e,s)=>{const n=s().display.isBulkEditing,a=f.Ay.scrollPanel.scrollY,i=!n&&0===a&&!(0,y.Kz)(s());e({type:c._X,payload:{...t,canRerender:i}}),(0,p.Q2)(null,t.successLinks,f.Ay)},W=()=>async(t,e)=>{t(B())},B=()=>async(t,e)=>{const s=Date.now();if(s-f.Ay.randomHouseworkTasks.dt<864e5)return;const n=Math.random();t(n<.25?H():n<.5?(0,h.n5)():n<.75?J():V()),f.Ay.randomHouseworkTasks.dt=s},H=()=>async(t,e)=>{if(!e().settings.doDeleteOldLinksInTrash)return;const s=d.tA0;if(e().display.listName===s)return;const n=e().pendingSslts,a=(0,p.Xp)(e()),i=(0,p.ln)(e()),{linkMetas:o,prevFPathsPerMids:r,ssltInfos:l}=(0,p.dG)(a,i,n),u=o.filter((t=>t.listName===s)),f=[],y=[],h={},g={};for(const c of u){const{id:t,fpaths:e}=c,n=(0,p.ju)(t);let a=c.updatedDT;(0,p.Gv)(l[n])&&l[n].updatedDT>a&&(a=l[n].updatedDT);if((Date.now()-a)/1e3/60/60/24<=d.P$0)continue;const i=r[n];if(Array.isArray(h[t])||(h[t]=[]),Array.isArray(g[t])||(g[t]=[]),f.push(s),y.push(t),Array.isArray(e)&&h[t].push(...e),Array.isArray(i)&&g[t].push(...i),y.length>=d.htT)break}if(0===y.length)return;const m={listNames:f,ids:y,fpathsPerId:h,prevFPathsPerId:g};t({type:c.PH,payload:m,meta:{offline:{effect:{method:c.U7,params:m},commit:{type:c.X4},rollback:{type:c.Ot,meta:m}}}})},J=()=>async(t,e)=>{const s=e().pendingSslts,n=(0,p.Xp)(e()),a=(0,p.ln)(e()),{prevFPathsPerMids:i}=(0,p.dG)(n,a,s);let r=d.htT;e().user.hubUrl===d.MbX&&(r=60);const l=[];for(const o of Object.values(i)){for(const t of o)l.push({id:t,type:d.BCn,path:t,doIgnoreDoesNotExistError:!0});if(l.length>=r)break}if(0!==l.length)try{const t={values:l,isSequential:!1,nItemsForNs:d.htT};await o.A.performFiles(t)}catch(c){console.log("cleanUpLinks error: ",c)}},V=()=>async(t,e)=>{const{cleanUpStaticFilesDT:s}=e().localSettings;if(!s)return;const n=Date.now();let a=1/(24*d.P$0*60*60*1e3)*Math.abs(n-s);a=Math.max(.01,Math.min(a,.99));if(a>Math.random()){t({type:c.N});try{const s=await(async t=>{const e=t().pendingSslts,s=(0,p.Xp)(t()),n=(0,p.ln)(t()),{linkMetas:a}=(0,p.dG)(s,n,e),i=(0,p.yY)(a);let l=d.htT;t().user.hubUrl===d.MbX&&(l=60);let c=(0,p.dT)(t());const u=[],f=[];for(const o of c){const{id:t}=(0,p.Dd)(o);if(!i.includes((0,p.ju)(t))&&(u.push(t),f.push({id:o,type:d.BCn,path:o,doIgnoreDoesNotExistError:!0}),f.length>=l))break}if(f.length>0){const t={values:f,isSequential:!1,nItemsForNs:d.htT};await o.A.performFiles(t)}c=await r.A.getStaticFPaths();const y=[];for(const o of c){const{id:t}=(0,p.Dd)(o);if(!i.includes((0,p.ju)(t))&&(u.push(t),y.push(o),y.length>=l))break}return y.length>0&&await r.A.deleteFiles(y),u})(e);t({type:c.$U,payload:{ids:s}})}catch(i){console.log("Error when clean up static files: ",i),t({type:c.kS})}}},Y=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return async(s,n)=>{if(!t){if(e){const t=n().listNameEditors,e=n().settings.listNameMap,a=(0,p.Yv)(t,e);if((0,p.Gv)(a)){for(const t in a)(0,p.Et)(a[t].blurCount)||(a[t].blurCount=0),a[t].blurCount+=1;return s(z(a)),s(Lt(d.zrI)),void s((0,y.e5)(d.dhM,!0))}const i=n().tagNameEditors,o=n().settings.tagNameMap,r=(0,p._H)(i,o);if((0,p.Gv)(r)){for(const t in r)(0,p.Et)(r[t].blurCount)||(r[t].blurCount=0),r[t].blurCount+=1;return s(oe(r)),s(Lt(d.plg)),void s((0,y.e5)(d.dhM,!0))}}s(yt())}s((0,y.e5)(d.bzM,t)),t&&(s(b(null,!1,!1)),s(G(null,!1)))}},Z=(t,e,s,n)=>async(a,i)=>{const o={};if(t&&(o.settingsViewId=t),[!0,!1].includes(e)&&(o.isSettingsSidebarShown=e),[!0,!1].includes(s)&&(o.didSettingsCloseAnimEnd=s),[!0,!1].includes(n)&&(o.didSettingsSidebarAnimEnd=n,!n)){const{updateSettingsViewIdCount:t}=i().display;o.updateSettingsViewIdCount=t+1}a({type:c.qQ,payload:o})},z=t=>({type:c.wr,payload:t}),tt=t=>{let e=0;const s=Date.now(),n=[];for(const a of t){const t={listName:`${s+e}-${(0,p.DU)(4)}`,displayName:a};n.push(t),e+=1}return{type:c.Cx,payload:n}},et=(t,e)=>({type:c.Hm,payload:{listNames:t,newNames:e}}),st=(t,e)=>({type:c.p,payload:{listName:t,direction:e}}),nt=(t,e)=>({type:c.RG,payload:{listName:t,parent:e}}),at=(t,e)=>async(s,n)=>{const a=[e.listName];a.push(...(0,p.yP)(e.children));const i=n().pendingSslts,o=(0,p.Xp)(n()),r=(0,p.ln)(n()),{inUseListNames:l}=(0,p.dG)(o,r,i),c=[];for(const t of a)c.push(!l.includes(t));c.every((t=>!0===t))?(s(ct(e.listName)),s(At(d.OcN)),s((0,y.e5)(d.atb,!0)),s(z({[t]:{msg:"",isCheckingCanDelete:!1}}))):s(z({[t]:{msg:d.iMY[d.pFv],isCheckingCanDelete:!1}}))},it=t=>async(e,s)=>{const{listNameMap:n}=s().settings,a=[];for(const i of t){const{listNameObj:t}=(0,p.$L)(i,n);a.push(t.listName),a.push(...(0,p.yP)(t.children))}e({type:c.An,payload:{listNames:a}})},ot=t=>({type:c.ZM,payload:t}),rt=t=>({type:c.lA,payload:t}),lt=t=>({type:c.MT,payload:t}),ct=t=>({type:c.ce,payload:t}),dt=async(t,e)=>{const s={settings:e().settings};t({type:c.Eq,payload:s,meta:{offline:{effect:{method:c.Eq,params:{dispatch:t,getState:e}},commit:{type:c.MI},rollback:{type:c.FR}}}})},pt=t=>async(e,s)=>{if(0===t.length)return;const n=[];for(const i of t)n.push({id:i,type:d.$tn,path:i,content:{}});try{const t={values:n,isSequential:!1,nItemsForNs:d.htT};await o.A.performFiles(t)}catch(a){console.log("updateSettings clean up error: ",a)}await Jt(e,s)},ut=async(t,e)=>{t({type:c.DI,meta:{offline:{effect:{method:c.DI,params:{dispatch:t,getState:e}},commit:{type:c.JG},rollback:{type:c.kH}}}})},ft=t=>async(e,s)=>{if(!(0,p.Kg)(t))return;const n=t,a=[{id:n,type:d.BCn,path:n,doIgnoreDoesNotExistError:!0}];try{const t={values:a,isSequential:!1,nItemsForNs:d.htT};await o.A.performFiles(t)}catch(i){console.log("updateInfo clean up error: ",i)}},yt=()=>async(t,e)=>{await dt(t,e),await ut(t,e)},ht=()=>async(t,e)=>{await dt(t,e)},gt=()=>async(t,e)=>{const s=e().settings,n=e().snapshot.settings,a=e().pendingSslts,i=e().pendingTags,o=(0,p.Xp)(e()),r=(0,p.ln)(e()),l=(0,p.x$)(e()),{linkMetas:d,inUseListNames:u}=(0,p.dG)(o,r,a),f={listNames:u,tagNames:(0,p.Vr)(d,l,i),settings:n,doFetch:s.doDescendingOrder!==n.doDescendingOrder};t({type:c.Kx,payload:f})},mt=()=>async(t,e)=>{e().display.isSettingsPopupShown||await ut(t,e)},kt=t=>async(e,s)=>{const n=s().settings,a=s().conflictedSettings.contents,i=Date.now(),o=a.map((t=>t.fpath)),r=a.map((t=>t.id)),l=a.find((e=>e.id===t)),d=(0,p.Cd)(`${i}${(0,p.DU)(4)}`,r),f=(0,p.BK)(d),y={...u.ji};for(const t in y)t in l&&(y[t]=l[t]);const h=s().pendingSslts,g=s().pendingTags,m=(0,p.Xp)(s()),k=(0,p.ln)(s()),w=(0,p.x$)(s()),{linkMetas:v,inUseListNames:N}=(0,p.dG)(m,k,h),A={settingsFPath:f,listNames:N,tagNames:(0,p.Vr)(v,w,g),settings:y,doFetch:y.doDescendingOrder!==n.doDescendingOrder,_settingsFPaths:o};e({type:c.pO,payload:A,meta:{offline:{effect:{method:c.E5,params:A},commit:{type:c.tf,meta:A},rollback:{type:c.Uk,meta:A}}}})},wt=t=>async(e,s)=>{const n=[];for(const i of t)n.push({id:i,type:d.$tn,path:i,content:{}});try{const t={values:n,isSequential:!1,nItemsForNs:d.htT};await o.A.performFiles(t)}catch(a){console.log("mergeSettings clean up error: ",a)}},vt=t=>({type:c.PW,payload:t}),Nt=t=>async(e,s)=>{e({type:s().localSettings.doUseLocalLayout?c.QR:c.ci,payload:t})},At=t=>({type:c.tu,payload:t}),Lt=t=>({type:c.w5,payload:t}),It=(t,e)=>({type:c.c1,payload:{listNamesMode:t,listNamesAnimType:e}}),Dt=t=>({type:c.EF,payload:t}),St=t=>async(e,s)=>{const a=s().info.purchases;if(!(0,p.ER)(a))return e(Dt(d.ft2)),void e((0,y.e5)(d.oPm,!0));const i=(0,p.w5)(s()),o=s().pendingPins,r=(0,p.L)(i,o,!0),l=Object.values(r).map((t=>t.rank)).sort();let u;if(l.length>0){const t=l[l.length-1];u=n.X.parse(`0|${t.replace("_",":")}`).genNext()}else u=n.X.middle();let f=Date.now();const h=[];for(const n of t){const t=(0,p.ju)(n);if((0,p.Gv)(r[t]))continue;const e=u.toString().slice(2).replace(":","_");h.push({rank:e,updatedDT:f,addedDT:f,id:n}),u=u.genNext(),f+=1}if(0===h.length)return;const g={pins:h};e({type:c.pq,payload:g,meta:{offline:{effect:{method:c.pq,params:{...g,getState:s}},commit:{type:c.Br,meta:g},rollback:{type:c.O7,meta:g}}}}),await C(e,s)},Pt=t=>async(e,s)=>{const n=(0,p.w5)(s()),a=t.map((t=>(0,p.ju)(t))),i=[];for(const t of n){const{rank:e,updatedDT:s,addedDT:n,id:o}=(0,p.AI)(t),r=(0,p.ju)(o);a.includes(r)&&i.push({rank:e,updatedDT:s,addedDT:n,id:o})}if(0===i.length)return void console.log("In unpinLinks, no pin found for ids: ",t);const o={pins:i};e({type:c.m3,payload:o,meta:{offline:{effect:{method:c.m3,params:o},commit:{type:c.Qi,meta:o},rollback:{type:c.p$,meta:o}}}}),await C(e,s)},Et=(t,e)=>async(s,a)=>{const i=a().links,o=a().display.showingLinkIds,r=(0,p.w5)(a()),l=a().pendingPins;if(!Array.isArray(o))return void console.log("In movePinnedLink, no showingLinkIds found for link id: ",t);let u=o.map((t=>(0,p.TE)(t,i)));u=u.filter((t=>(0,p.Gv)(t))),u=u.filter((t=>d.VRb.includes(t.status)));const[f]=(0,p.CM)(u,r,l,(t=>(0,p.ju)(t.id))),y=f.findIndex((e=>e.value.id===t));if(y<0)return void console.log("In movePinnedLink, no pin found for link id: ",t);let h;if(e===d.KxA){if(0===y)return;if(1===y){const t=f[y-1].pin.rank;h=n.X.parse(`0|${t.replace("_",":")}`).genPrev().toString()}else{const t=f[y-1].pin.rank,e=f[y-2].pin.rank,s=n.X.parse(`0|${t.replace("_",":")}`),a=n.X.parse(`0|${e.replace("_",":")}`);h=t===e?a.toString():a.between(s).toString()}}else{if(e!==d.JlW)throw new Error(`Invalid direction: ${e}`);if(y===f.length-1)return;if(y===f.length-2){const t=f[y+1].pin.rank;h=n.X.parse(`0|${t.replace("_",":")}`).genNext().toString()}else{const t=f[y+1].pin.rank,e=f[y+2].pin.rank,s=n.X.parse(`0|${t.replace("_",":")}`),a=n.X.parse(`0|${e.replace("_",":")}`);h=t===e?s.toString():s.between(a).toString()}}h=h.slice(2).replace(":","_");const g=Date.now(),{addedDT:m}=f[y].pin,k={rank:h,updatedDT:g,addedDT:m,id:t};s({type:c.vO,payload:k,meta:{offline:{effect:{method:c.pq,params:{pins:[k]}},commit:{type:c.vp,meta:k},rollback:{type:c.sJ,meta:k}}}}),await C(s,a)},Mt=()=>async(t,e)=>{const s=e().pendingPins,n=[],a=[],i=[];for(const o in s){const t=s[o],[e,r]=[t.status,(0,p.wg)(t,[d.XQv])];e===c.O7?n.push(r):e===c.p$?a.push(r):e===c.sJ&&i.push(r)}if(n.length>0){const s={pins:n};t({type:c.pq,payload:s,meta:{offline:{effect:{method:c.pq,params:{...s,getState:e}},commit:{type:c.Br,meta:s},rollback:{type:c.O7,meta:s}}}})}if(a.length>0){const e={pins:a};t({type:c.m3,payload:e,meta:{offline:{effect:{method:c.m3,params:e},commit:{type:c.Qi,meta:e},rollback:{type:c.p$,meta:e}}}})}if(i.length>0)for(const o of i){const e={...o};t({type:c.vO,payload:e,meta:{offline:{effect:{method:c.pq,params:{pins:[e]}},commit:{type:c.vp,meta:e},rollback:{type:c.sJ,meta:e}}}})}(n.length>0||a.length>0||i.length>0)&&await C(t,e)},Tt=()=>async(t,e)=>{t({type:c.tZ}),await C(t,e)},bt=()=>async(t,e)=>{const s=e().pendingSslts,n=(0,p.Xp)(e()),a=(0,p.ln)(e()),i=(0,p.w5)(e()),{linkMetas:r}=(0,p.dG)(n,a,s),l=(0,p.yY)(r),c=(0,p.Tu)(i);let u=d.htT;e().user.hubUrl===d.MbX&&(u=60);const f=[];for(const o of i){const{id:t}=(0,p.AI)(o),e=(0,p.ju)(t);if((!(0,p.Kg)(e)||!l.includes(e)||!(0,p.Gv)(c[e])||c[e].fpath!==o)&&(f.push({id:o,type:d.BCn,path:o,doIgnoreDoesNotExistError:!0}),f.length>=u))break}if(0!==f.length)try{const t={values:f,isSequential:!1,nItemsForNs:d.htT};await o.A.performFiles(t)}catch(y){console.log("cleanUpPins error: ",y)}},Ft=t=>({type:c.yR,payload:t}),Ot=(t,e)=>async(s,n)=>{const a=n().info.purchases;if(!(0,p.ER)(a))return s(Dt(d.WIc)),void s((0,y.e5)(d.oPm,!0));s({type:n().localSettings.doUseLocalTheme?c.Eo:c.wB,payload:{mode:t,customOptions:e}})},Gt=t=>async(e,s)=>{const n=s().localSettings.doUseLocalTheme?s().localSettings.themeCustomOptions:s().settings.themeCustomOptions,a=s().window.is24HFormat;let i;for(const c of n)if(c.mode===t){i=c;break}if(!i)return;const{hour:o,minute:r,period:l}=(0,p.m8)(i.startTime,a);e({type:c.hw,payload:{updatingThemeMode:t,hour:o,minute:r,period:l}})},Ct=(t,e,s)=>{const n={};return(0,p.Kg)(t)&&t.length>0&&(n.hour=t),(0,p.Kg)(e)&&e.length>0&&(n.minute=e),["AM","PM"].includes(s)&&(n.period=s),{type:c.qK,payload:n}},$t=()=>async(t,e)=>{const s=e().localSettings.doUseLocalTheme?e().localSettings.themeCustomOptions:e().settings.themeCustomOptions,{updatingThemeMode:n,hour:a,minute:i,period:o}=e().timePick,r=d.yAf,l=[];let c;for(const d of s)d.mode===n?c=d:l.push({...d});if(!c)return;const u=(0,p.__)(a,i,o);l.push({...c,startTime:u}),t(Ot(r,l))},jt=(t,e)=>async(s,n)=>{if(t){const t=n().info.purchases;if(!(0,p.ER)(t))return s(Dt(d.$tj)),void s((0,y.e5)(d.oPm,!0));s(L(e))}s((0,y.e5)(d.ppp,t))},Ut=(t,e,s,n,a,i,o,r)=>{const l={};return(0,p.Kg)(t)&&(l.title=t,l.didTitleEdit=!0),(0,p.Gv)(e)&&(l.image=e,l.imageUrl=null,l.didImageEdit=!0),o&&(l.image=null,l.imageUrl=null,l.didImageEdit=!0),(0,p.Et)(s)&&(l.rotate=s,l.didImageEdit=!0),(0,p.Et)(n)&&(l.translateX=n,l.didImageEdit=!0),(0,p.Et)(a)&&(l.translateY=a,l.didImageEdit=!0),(0,p.Et)(i)&&(l.zoom=i,l.didImageEdit=!0),(0,p.Kg)(r)?l.msg=r:l.msg="",{type:c.YM,payload:l}},Qt=(t,e)=>({type:c.dV,payload:{[t]:e}}),xt=(t,e)=>async(s,n)=>{const a=n().links,i=n().display.selectingLinkId,o=Date.now(),{listName:r,link:l}=(0,p.fn)(i,a);if(!(0,p.Kg)(r)||!(0,p.Gv)(l))return void console.log("In updateCustomData, no found listName or link for id:",i);const u=(0,p.wg)(l,d.GlW),y={};for(const t in u)"custom"!==t&&(y[t]=u[t]);if((0,p.Kg)(t)&&t.length>0&&("custom"in y||(y.custom={}),y.custom.title=t),(0,p.Kg)(e)&&e.length>0&&("custom"in y||(y.custom={}),y.custom.image=e),(0,p.n4)(u,y))return;y.id=`${(0,p.ju)(u.id)}-${(0,p.DU)(4)}-${o}`,y.fromLink=u;const h={listName:r,fromLink:u,toLink:y};s({type:c.jk,payload:h,meta:{offline:{effect:{method:c.jk,params:h},commit:{type:c.hK},rollback:{type:c.AN,meta:h}}}}),(0,p.Q2)(null,[y],f.Ay)},Kt=(t,e,s,n,a)=>async(t,e)=>{if(n.length>0){const t=[];for(const e of n)t.push({id:e,type:d.BCn,path:e,doIgnoreDoesNotExistError:!0});try{const e={values:t,isSequential:!1,nItemsForNs:d.htT};await o.A.performFiles(e)}catch(s){console.log("updateCustomData clean up error: ",s)}}a.length>0&&await r.A.deleteFiles(a)},qt=t=>({type:c.D5,payload:t}),Xt=t=>({type:c.Cr,payload:t}),Rt=t=>async(e,s)=>{const n=s().info.purchases;if(!(0,p.ER)(n))return e(Dt(d.jpi)),void e((0,y.e5)(d.oPm,!0));e(qt(t)),e((0,y.e5)(d.bcx,!0))},_t=(t,e,s,n)=>async(a,i)=>{const o=(0,p.Oj)(e);o===d.VjV?(a(Xt({isLoadingShown:!0,errMsg:""})),await(0,p.yy)(16),e=await l.A.encrypt(e),a({type:c.bi,payload:{listName:t,password:e,canChangeListNames:s,canExport:n}}),a((0,y.e5)(d.bcx,!1))):a(Xt({errMsg:d.T61[o]}))},Wt=(t,e)=>async(s,n)=>{const a=(0,p.Oj)(e);if(a!==d.VjV)return void s(Xt({errMsg:d.T61[a]}));s(Xt({isLoadingShown:!0,errMsg:""})),await(0,p.yy)(16);const i=n().lockSettings.lockedLists[t];let o=!1;if((0,p.Gv)(i)&&(0,p.Kg)(i.password)){await l.A.decrypt(i.password)===e&&(o=!0)}o?(s({type:c.ad,payload:{listName:t}}),s((0,y.e5)(d.bcx,!1))):s(Xt({isLoadingShown:!1,errMsg:"Password is not correct. Please try again."}))},Bt=()=>async(t,e)=>{const s=e().display.listName;t({type:c.V9,payload:{listName:s}})},Ht=(t,e)=>async(s,n)=>{const a=(0,p.Oj)(e);if(a!==d.VjV)return void s(Xt({errMsg:d.T61[a]}));s(Xt({isLoadingShown:!0,errMsg:""})),await(0,p.yy)(16);const i=n().lockSettings.lockedLists[t];let o=!1;if((0,p.Gv)(i)&&(0,p.Kg)(i.password)){await l.A.decrypt(i.password)===e&&(o=!0)}o?(s({type:c._3,payload:{listName:t,unlockedDT:Date.now()}}),s((0,y.e5)(d.bcx,!1))):s(Xt({isLoadingShown:!1,errMsg:"Password is not correct. Please try again."}))},Jt=async(t,e)=>{const{listNameMap:s}=e().settings,n=e().lockSettings,a=[];for(const i in n.lockedLists)(0,p.fm)(i,s)||a.push(i);0!==a.length&&t({type:c.ZQ,payload:{listNames:a}})},Vt=(t,e)=>{const[s,n]=[Array.isArray(t),Array.isArray(e)];if(!s&&!n)return!1;if(!s||!n)return!0;if(t.length!==e.length)return!0;for(let a=0;a<t.length;a++){const[s,n]=[t[a],e[a]];if(s.tagName!==n.tagName)return!0}return!1},Yt=(t,e)=>async(s,n)=>{if(t){if(e){const t=n().info.purchases;if(!(0,p.ER)(t))return s(Dt(d.Mc0)),void s((0,y.e5)(d.oPm,!0))}const t=(t=>{const e=(0,p.x$)(t()),s=t().pendingTags,n=t().settings.tagNameMap,a=t().display.selectingLinkId,i=t().display.isBulkEditing,o=t().display.selectedLinkIds,r={...u.bN};let l;if(i){if(0===o.length)return r.mode=d.uYZ,r;l=o}else{if(!(0,p.Kg)(a))return r.mode=d.uYZ,r;l=[a]}r.ids=l;const c=(0,p.xF)(e,s),f=l.map((t=>(0,p.ju)(t)));let y=null;(0,p.Gv)(c[f[0]])&&c[f[0]].values.length>0&&(y=c[f[0]].values);for(const u of f.slice(1)){let t=null;if((0,p.Gv)(c[u])&&c[u].values.length>0&&(t=c[u].values),Vt(y,t))return r.mode=d.Vt1,r}if(Array.isArray(y)&&y.length>0){[r.mode,r.values]=[d.Bcq,[]];for(const{tagName:t}of y){const{tagNameObj:e}=(0,p.LY)(t,n);(0,p.Gv)(e)&&r.values.push({tagName:t,displayName:e.displayName,color:e.color})}}r.hints=[];for(const d of n){const{tagName:t,displayName:e,color:s}=d,n=r.values.some((e=>e.tagName===t));r.hints.push({tagName:t,displayName:e,color:s,isBlur:n})}return r})(n);if(t.mode===d.uYZ)return;s({type:c.VE,payload:t})}s((0,y.e5)(d.SMo,t))},Zt=(t,e,s,n,a)=>{const i={};return Array.isArray(t)&&(i.values=t),Array.isArray(e)&&(i.hints=e),(0,p.Kg)(s)&&(i.displayName=s),(0,p.Kg)(n)&&(i.color=n),(0,p.Kg)(a)?i.msg=a:i.msg="",{type:c.VE,payload:i}},zt=(t,e,s,n)=>async(a,i)=>{s=s.trim();const o=(0,p.jm)(null,s,[]);if(o!==d.asr)return void a(Zt(null,null,null,null,d.Gt2[o]));if(t.some((t=>t.displayName===s)))return void a(Zt(null,null,null,null,d.Gt2[d.tKS]));const r=i().settings.tagNameMap,{tagNameObj:l}=(0,p.YR)(s,r);let c;(0,p.Gv)(l)&&(c=l.tagName),(0,p.Kg)(c)||(c=`${Date.now()}-${(0,p.DU)(4)}`);const u=[...t,{tagName:c,displayName:s,color:n}],f=e.map((t=>t.tagName!==c?t:{...t,isBlur:!0}));a(Zt(u,f,"",null,""))},te=(t,e)=>async(s,n)=>{if(!Array.isArray(t)||0===t.length)return void console.log("In updateTagData, invalid ids: ",t);const a={};for(const i of t)a[i]=e;await ee(t,a)(s,n)},ee=(t,e)=>async(s,n)=>{const a=(0,p.x$)(n()),i=(0,p.xF)(a,{}),o=n().settings.tagNameMap,r=n().snapshot.settings.tagNameMap,l=[],d={};for(const c of t){const[t,s]=[e[c],(0,p.ju)(c)],n=[],a=[];if((0,p.Gv)(i[s]))for(const e of i[s].values)n.push(e.tagName);for(const e of t)a.push(e.tagName);(0,p.Ob)(n,a)||(l.push(c),d[c]=t)}if(0===l.length)return;const u={},f=[],y=[];for(const t of l){const e=d[t];for(const s of e){const{tagNameObj:e}=(0,p.LY)(s.tagName,o),{tagNameObj:n}=(0,p.LY)(s.tagName,r);(0,p.Gv)(e)&&(0,p.Gv)(n)||(Array.isArray(u[t])||(u[t]=[]),u[t].push(s),y.includes(s.tagName)||(f.push(s),y.push(s.tagName)))}}const h={ids:l,valuesPerId:d,newTagNameObjsPerId:u,newTagNameObjs:f};s({type:c.Bk,payload:h,meta:{offline:{effect:{method:c.Bk,params:{...h,getState:n}},commit:{type:c.X8,meta:h},rollback:{type:c.WR,meta:h}}}})},se=(t,e)=>async(s,n)=>{const a={ids:t,valuesPerId:e};s({type:c.uj,payload:a,meta:{offline:{effect:{method:c.uj,params:{...a,getState:n}},commit:{type:c.Gn},rollback:{type:c.Z7,meta:a}}}})},ne=()=>async(t,e)=>{const s=e().pendingTags,n=[],a={},i=[],o={};for(const r in s){const{status:t,values:e}=s[r];t===c.WR?(n.push(r),a[r]=e):t===c.Z7&&(i.push(r),o[r]=e)}n.length>0&&await ee(n,a)(t,e),i.length>0&&await se(i,o)(t,e)},ae=()=>async(t,e)=>{const s=e().settings,n=e().snapshot.settings,a=e().pendingTags,i=(0,p.n4)(s.tagNameMap,n.tagNameMap),o=[],r=[],l=[],d=[];for(const p in a){const{status:t,newTagNameObjs:e}=a[p];if([c.WR,c.Z7].includes(t)&&o.push(p),t!==c.WR)for(const s of e)l.includes(s.tagName)||l.push(s.tagName);else for(const s of e)r.includes(s.tagName)||r.push(s.tagName)}if(!i&&r.length>0){for(const e of n.tagNameMap)l.includes(e.tagName)||l.push(e.tagName);const t=(0,p.x$)(e());for(const e of t){const{tagName:t}=(0,p.tF)(e);l.includes(t)||l.push(t)}for(const e of r)l.includes(e)||d.push(e)}t({type:c.q1,payload:{ids:o,unusedTagNames:d}})},ie=()=>async(t,e)=>{const s=e().pendingSslts,n=(0,p.Xp)(e()),a=(0,p.ln)(e()),i=(0,p.x$)(e()),{linkMetas:r}=(0,p.dG)(n,a,s),l=(0,p.yY)(r),c=(0,p._3)(i);let u=d.htT;e().user.hubUrl===d.MbX&&(u=60);const f=[];for(const o of i){if(f.length>=u)break;const{id:t}=(0,p.tF)(o),e=(0,p.ju)(t);if(!(0,p.Kg)(e)||!l.includes(e)||!(0,p.Gv)(c[e])){f.push({id:o,type:d.BCn,path:o,doIgnoreDoesNotExistError:!0});continue}c[e].values.some((t=>t.fpath===o))||f.push({id:o,type:d.BCn,path:o,doIgnoreDoesNotExistError:!0})}if(0!==f.length)try{const t={values:f,isSequential:!1,nItemsForNs:d.htT};await o.A.performFiles(t)}catch(y){console.log("cleanUpTags error: ",y)}},oe=t=>({type:c._7,payload:t}),re=(t,e)=>{let s=Date.now();const n=[];for(let a=0;a<t.length;a++){const[i,o]=[t[a],e[a]],r={tagName:`${s}-${(0,p.DU)(4)}`,displayName:i,color:o};n.push(r),s+=1}return{type:c.MJ,payload:n}},le=(t,e)=>({type:c.E$,payload:{tagNames:t,newNames:e}}),ce=(t,e)=>({type:c.dT,payload:{tagName:t,direction:e}}),de=(t,e)=>{},pe=(t,e)=>async(s,n)=>{const a=n().pendingSslts,i=n().pendingTags,o=(0,p.Xp)(n()),r=(0,p.ln)(n()),l=(0,p.x$)(n()),{linkMetas:c}=(0,p.dG)(o,r,a);(0,p.Vr)(c,l,i).includes(e.tagName)?s(oe({[t]:{msg:d.Gt2[d.TB2],isCheckingCanDelete:!1}})):(s(fe(e.tagName)),s(At(d.E3J)),s((0,y.e5)(d.atb,!0)),s(oe({[t]:{msg:"",isCheckingCanDelete:!1}})))},ue=t=>({type:c.IQ,payload:{tagNames:t}}),fe=t=>({type:c.GB,payload:t}),ye=t=>({type:c.QG,payload:{bulkEditMenuAnimType:t}})},1701:(t,e,s)=>{s.d(e,{n5:()=>E,GO:()=>A,i4:()=>L,Og:()=>P,By:()=>I,vi:()=>S,Xq:()=>M,cO:()=>T,dB:()=>F,Rh:()=>G,OJ:()=>O});var n=s(1769),a=s(3151),i=s(629),o=s(8159),r=s(8526);const l=!window.location.href.startsWith(o.ffP),c=t=>{if(t!==o.ppF)throw new Error(`In paddleWrapper.getProduct, invalid productId: ${t}`);return l?46920:811082};let d=null;const p=t=>{try{if("Checkout.Complete"===t.event){const e=(t=>{if(![46920,811082].includes(t))throw new Error(`In paddleWrapper.getProductId, invalid product: ${t}`);return o.ppF})(t.eventData.product.id),s=t.eventData.checkout.id,n=t.eventData.user.id,a=t.eventData.checkout.passthrough;return void u({productId:e,purchaseToken:s,paddleUserId:n,passthrough:a})}if("Checkout.Close"===t.event&&!t.eventData.checkout.completed)return void f({code:"E_USER_CANCELLED"})}catch(e){return void f(e)}};let u=null;let f;const y={initConnection:async()=>{if(d=window.Paddle,!(0,r.Gv)(d))throw new Error("Invalid window.Paddle");return l&&d.Environment.set("sandbox"),d.Setup({vendor:l?11185:163987,eventCallback:p}),!0},purchaseUpdatedListener:t=>(u=t,{remove:()=>{u=null}}),purchaseErrorListener:t=>(f=t,{remove:()=>{f=null}}),getSubscriptions:async t=>await Promise.all(t.map((t=>(t=>new Promise(((e,s)=>{d.Product.Prices(c(t),(n=>{(0,r.Gv)(n)?e({productId:t,localizedPrice:n.recurring.price.gross}):s(new Error(`Invalid prices: ${n}`))}))})))(t)))),requestSubscription:async t=>{let e=a.A.getItemSync(o.NjW);if(!(0,r.Kg)(e)){const t=(await i.A.signECDSA(o.ejf)).publicKey;e=`${(0,r.DU)(8)}-${(0,r.DU)(8)}-${(0,r.DU)(8)}-${(0,r.DU)(8)}`,await n.A.post(o.Ojf,{userId:t,randomId:e}),a.A.setItemSync(o.NjW,e)}const s={randomId:e};d.Checkout.open({product:c(t),passthrough:JSON.stringify(s)})}};var h=s(8103),g=s(8678);const m=async t=>{if(!t)return{status:o.uYZ};const e=o.L3j,s=(await i.A.signECDSA(o.ejf)).publicKey,a=t.productId,r=t.purchaseToken,l=t.paddleUserId,c=t.passthrough;if(!r)return console.log("No purchaseToken in rawPurchase"),{status:o.uYZ};const d={source:e,userId:s,productId:a,token:r,paddleUserId:l,passthrough:c};let p;try{p=(await n.A.post(o.lGw,d)).data}catch(u){return console.log(`Error when contact IAP server to verify with reqBody: ${JSON.stringify(d)}, Error: `,u),{status:o.HVg}}return p},k=async t=>{let e;for(let s=1;s<=3;s++){if(e=await m(t),e.status===o.dOD)return e;s<3&&await(0,r.yy)((0,r.XM)([3e3,4500,6e3]))}return e},w=async t=>{const e=await i.A.signECDSA(o.ejf),s=await a.A.getItem(o.NjW),r={source:o.L3j,userId:e.publicKey,signature:e.signature,appId:o.igh,doForce:t,randomId:s};return await n.A.post(o.ilu,r)},v=(t,e,s,n,a)=>async(i,l)=>{const{purchaseState:c,restoreStatus:d,refreshStatus:p}=l().iap;if(c===h.uU||d===h.k8||p===h.f)return;let u;i({type:t});try{if(u=(await w(n)).data,a)return void i({type:e,payload:u});if(u.status===o.dOD){const t=(0,r.b6)(u.purchases);if(t&&t.status===o.HcD)return void i({type:e,payload:u})}}catch(f){return console.log("Error when contact IAP server to get purchases: ",f),void i({type:s})}i({type:e,payload:u})},N=(t,e,s)=>{t?(g.Ay.iap.updatedEventEmitter||(g.Ay.iap.updatedEventEmitter=y.purchaseUpdatedListener(((t,e)=>async e=>{const s=await k(e);t({type:h.Qp,payload:{...s,rawPurchase:e}})})(e))),g.Ay.iap.errorEventEmitter||(g.Ay.iap.errorEventEmitter=y.purchaseErrorListener(((t,e)=>async s=>{console.log("Error in iapErrorListener: ",s),"E_USER_CANCELLED"===s.code?(D(t,e),t(F(null,null))):t({type:h.bP})})(e,s)))):(g.Ay.iap.updatedEventEmitter&&(g.Ay.iap.updatedEventEmitter.remove(),g.Ay.iap.updatedEventEmitter=null),g.Ay.iap.errorEventEmitter&&(g.Ay.iap.errorEventEmitter.remove(),g.Ay.iap.errorEventEmitter=null))},A=function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return async(e,s)=>{N(!1,e,s),t||(g.Ay.iap.didGetProducts=!1,e(b(null,null,null)))}},L=t=>async(e,s)=>{if(!g.Ay.iap.didGetProducts||t){g.Ay.iap.didGetProducts=!0,e({type:h.oH}),t&&await A(!0)(e,s);try{const t=await y.initConnection();N(!0,e,s);let n=null;t&&(n=await y.getSubscriptions([o.ppF])),e({type:h.oZ,payload:{canMakePayments:t,products:n}})}catch(n){console.log("Error when init iap and get products: ",n),e({type:h.dm})}}},I=t=>async(e,s)=>{e({type:h.uU});try{await y.requestSubscription(t.productId)}catch(n){console.log("Error when request purchase: ",n),"E_USER_CANCELLED"===n.code?e(F(null,null)):e({type:h.bP})}},D=async(t,e)=>{const{purchases:s}=e().info;if(!(0,r.Gk)(s))try{const e=(await w(!1)).data;if(e.status===o.dOD){const s=(0,r.Gk)(e.purchases);if(s)return void t({type:h.Qp,payload:{status:e.status,purchase:s,rawPurchase:null}})}}catch(n){console.log("checkRequestPurchase error:",n)}},S=()=>async(t,e)=>{await v(h.k8,h.aX,h.Fn,!1,!1)(t,e)},P=()=>async(t,e)=>{await v(h.f,h.hu,h.EX,!0,!1)(t,e)},E=()=>async(t,e)=>{const{purchases:s,checkPurchasesDT:n}=e().info,a=(0,r.Gk)(s);if(!a)return;const i=Date.now();let l=!1;if(i>=new Date(a.expiryDate).getTime()||!n)l=!0;else{let t=1/(24*o.P$0*60*60*1e3)*Math.abs(i-n);t=Math.max(.01,Math.min(t,.99)),l=t>Math.random()}l&&await v(h.f,h.hu,h.EX,!1,!0)(t,e)},M=()=>async(t,e)=>{const s=e().iap.rawPurchase;t({type:h.uU});const n=await k(s);t({type:h.Qp,payload:{...n,rawPurchase:s}})},T=()=>async(t,e)=>{const s=await i.A.signECDSA(o.ejf);t({type:h.Bf,payload:s.publicKey})},b=(t,e,s)=>({type:h.Cm,payload:{status:t,canMakePayments:e,products:s}}),F=(t,e)=>({type:h._e,payload:{status:t,rawPurchase:e}}),O=t=>({type:h.rU,payload:t}),G=t=>({type:h.Ip,payload:t})},2443:(t,e,s)=>{s.d(e,{A:()=>F});var n=s(8790),a=s(1860),i=s(8090),o=s(7138),r=s(6177),l=s(8565),c=s(8159),d=s(8526);const p=l.A._userSession,u=(0,r.Hq)(),f=async(t,e)=>{const s={...t};if(Array.isArray(t.values)&&[!0,!1].includes(t.isSequential)){s.values=[];for(const n of t.values){const t=await f(n,e);s.values.push(t)}}else if((0,d.Kg)(t.id)&&(0,d.Kg)(t.type)&&(0,d.Kg)(t.path)){if(t.type===c.$tn){const n=new a.Z(t.content,null),o=await n.load(),r=n.wasString,l="hex";s.content=await(0,i.Nq)(e,o,r,l)}}else console.log("In encryptData, invalid data:",t);return s},y={performFiles:async t=>{const e=l.A.loadUserData();let{appPrivateKey:s,gaiaHubConfig:a}=e;if(!(0,d.Gv)(a)){const t=new n.w({userSession:p});a=await t.getOrSetLocalGaiaHubConnection()}const i=(0,o.sP)(s),r=await f(t,i),c=`${a.server}/perform-files/${a.address}`,y=await u(c,{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:`bearer ${a.token}`},body:JSON.stringify(r)});if(y.ok){return await y.json()}throw new Error(`(performFiles) Error ${y.status}`)}},h=y,g=t=>{let e=[];const s=(t,s)=>{for(const n of e)if(n.rId===t)return void([n.dt,n.nRequests]=[Date.now(),s]);e.push({rId:t,dt:Date.now(),nRequests:s})};return{respectLimit:async(n,a)=>{const i=t,o=6e4;let r=!1;for(let t=1;t<=4;t++){e=e.filter((t=>t.dt>=Date.now()-o));let l=0,c=Date.now(),p=!1;for(let t=e.length-1;t>=0;t--){const s=e[t];if(s.nRequests+l>=i){p=!0;break}l+=s.nRequests,c=s.dt}if(!p){s(n,a),r=!0;break}if(t<4){const t=(0,d.XM)([1e3,1500,2e3,2500,3e3,3500,4e3,4500,5e3]);let e=o-(Date.now()-c)+t;e<0&&(e=0),e>o+t&&(e=o+t),await(0,d.yy)(e)}}return r},updateNetworkInfos:s}};var m=s(8678);const k=l.A._userSession;let w,v;const N=async function(t,e){let s,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n?(v||(v=g(288)),s=v):(w||(w=g(m.Ay.user.hubUrl===c.MbX?144:72)),s=w),await s.respectLimit(t,e)},A=function(t,e){let s,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n?(v||(v=g(288)),s=v):(w||(w=g(m.Ay.user.hubUrl===c.MbX?144:72)),s=w),s.updateNetworkInfos(t,e)},L={dangerouslyIgnoreEtag:!0},I=async t=>{const e={...t};if(Array.isArray(t.values)&&[!0,!1].includes(t.isSequential)){e.values=[];for(const s of t.values){const t=await I(s);e.values.push(t)}}else(0,d.Kg)(t.id)&&(0,d.Kg)(t.type)&&(0,d.Kg)(t.path)?t.type===c.$tn&&t.path.endsWith(c.rWq)&&(e.content=JSON.stringify(t.content)):console.log("In stringifyData, invalid data:",t);return e},D=async t=>{if(Array.isArray(t.values)&&0===t.values.length)return[];const e=`${Date.now()}${(0,d.DU)(4)}`;await N(e,2);const s=await I(t),n=await h.performFiles(s);return await(async(t,e)=>{if(!(0,d.Gv)(m.QC.fpaths))return;const s=(0,d.sI)(m.QC.fpaths),n=(0,d.nw)(t);for(const a of e){if(!a.success)continue;const{type:e,path:i}=n[a.id];e===c.$tn?(0,d.J_)(s,i):e===c.BCn?(0,d.Z5)(s,i):console.log("In cacheData, invalid data:",t)}m.QC.fpaths=s})(t,n),A(e,2),n},S=async t=>{const{id:e,type:s,path:a}=t;if(s===c.$tn){const s=await async function(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:L;const a=`${Date.now()}${(0,d.DU)(4)}`;await N(a,2),t.endsWith(c.rWq)&&(e=JSON.stringify(e));const i=new n.w({userSession:k}),o=await i.putFile(t,e,s);if((0,d.Gv)(m.QC.fpaths)){const e=(0,d.sI)(m.QC.fpaths);(0,d.J_)(e,t),m.QC.fpaths=e}return A(a,2),o}(a,t.content);return{success:!0,id:e,publicUrl:s}}if(s===c.BCn){try{await async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=`${Date.now()}${(0,d.DU)(4)}`;await N(s,2);const a=new n.w({userSession:k}),i=await a.deleteFile(t,e);if((0,d.Gv)(m.QC.fpaths)){const e=(0,d.sI)(m.QC.fpaths);(0,d.Z5)(e,t),m.QC.fpaths=e}return A(s,2),i}(a)}catch(i){if(!((0,d.Gv)(i)&&(0,d.Kg)(i.message)&&(i.message.includes("failed to delete")&&i.message.includes("404")||i.message.includes("deleteFile Error")&&i.message.includes("GaiaError error 5")||i.message.includes("does_not_exist")||i.message.includes("file_not_found"))))throw i}return{success:!0,id:e}}throw new Error(`Invalid data.type: ${t.type}`)},P=async t=>{const e=[];if(Array.isArray(t.values)&&[!0,!1].includes(t.isSequential))if(t.isSequential)for(const n of t.values){const t=await P(n);if(e.push(...t),t.some((t=>!t.success)))break}else{let s=1;(0,d.Et)(t.nItemsForNs)&&(s=Math.min(t.nItemsForNs,c.htT));for(let n=0;n<t.values.length;n+=s){const a=t.values.slice(n,n+s),i=await Promise.all(a.map((t=>P(t))));for(const t of i)e.push(...t)}}else if((0,d.Kg)(t.id)&&(0,d.Kg)(t.type)&&(0,d.Kg)(t.path))try{const s=await S(t);e.push(s)}catch(s){e.push({error:s.toString().slice(0,999),success:!1,id:t.id})}else console.log("In nsPerformFiles, invalid data:",t);return e},E={cachedFPaths:m.QC,getFile:async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=`${Date.now()}${(0,d.DU)(4)}`;m.Ay.user.hubUrl===c.MbX?await N(s,1,!0):await N(s,1);const a=new n.w({userSession:k});let i=await a.getFile(t,e);return t.endsWith(c.rWq)&&(i=JSON.parse(i)),m.Ay.user.hubUrl===c.MbX?A(s,1,!0):A(s,1),i},performFiles:async t=>{let e;return e=m.Ay.user.hubUrl===c.MbX?await D(t):await P(t),e},listFiles:async t=>{const e=`${Date.now()}${(0,d.DU)(4)}`;await N(e,2);const s=new n.w({userSession:k}),a=await s.listFiles((e=>"auth/authTimestamp"===e||t(e))),i=m.Ay.user.hubUrl===c.MbX?2400:100;return A(e,Math.ceil(a/i)+1),a}},M=E;var T=s(427);const b=async t=>{const e={linkFPaths:{},ssltFPaths:[],staticFPaths:[],settingsFPaths:[],infoFPath:null,pinFPaths:[],tagFPaths:[]};return await t((t=>((0,d.J_)(e,t),!0))),e},F={listFPaths:async function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(0,d.Gv)(M.cachedFPaths.fpaths)&&!t||(M.cachedFPaths.fpaths=await b(M.listFiles)),M.cachedFPaths.fpaths},getFiles:async function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s={responses:[],fpaths:[],contents:[]},n=[];for(const a of t){let t;[c.Aak,c.cPx,c.yyQ,c.rDG,c.$xt,c.gpL].some((t=>a.startsWith(t)))&&(t=await T.A.getFile(a,!0)),void 0!==t?(s.responses.push({content:t,fpath:a,success:!0}),s.fpaths.push(a),s.contents.push(t)):n.push(a)}for(let a=0;a<n.length;a+=c.htT){const t=n.slice(a,a+c.htT),i=await(0,d.lL)(M.getFile,t,0,e);for(const e of i)if(s.responses.push(e),s.fpaths.push(e.fpath),s.contents.push(e.content),e.success){const{fpath:t,content:s}=e;[c.Aak,c.cPx,c.yyQ,c.rDG,c.$xt,c.gpL].some((e=>t.startsWith(e)))&&await T.A.putFile(t,s)}}return s},performFiles:async t=>{const e=await M.performFiles(t),s=(0,d.nw)(t);for(const n of e){if(!n.success)continue;const{type:e,path:a,content:i}=s[n.id];[c.Aak,c.cPx,c.yyQ,c.rDG,c.$xt,c.gpL].some((t=>a.startsWith(t)))&&(e===c.$tn?await T.A.putFile(a,i):e===c.BCn?await T.A.deleteFile(a):console.log("In dataApi.performFiles, invalid data:",t))}return e}}},629:(t,e,s)=>{s.d(e,{A:()=>o});var n=s(8090),a=s(4635),i=s(8565);const o={signECDSA:async t=>{const e=i.A.loadUserData();return(0,n.iM)(e.appPrivateKey,t)},encrypt:t=>{const e={privateKey:i.A.loadUserData().appPrivateKey};return(0,a.h)(t,e)},decrypt:t=>{const e={privateKey:i.A.loadUserData().appPrivateKey};return(0,a.P)(t,e)}}},1769:(t,e,s)=>{s.d(e,{A:()=>a});var n=s(1407);const a={post:(t,e)=>n.A.post(t,e)}}}]);